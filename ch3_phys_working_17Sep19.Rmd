---
title: "Chapter 3: Physiology working"
author: "CBB"
date: "9/17/2019"
output: 
  html_document:
    theme: cerulean
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(warn = -1)
library("knitr")
```


```{r, include=FALSE}
#Packages to load
library("readr")
library("ggplot2")
library("dplyr")
library("tidyr")
library("tidyverse")
library("Rmisc")
library("cowplot")
library("ggfortify")
library("kableExtra")
library("readr")
library("lme4")
library("magick")
```


```{r, include=FALSE}
#Set some standards and units
#dodge width
dodge=position_dodge(width=0.3)
dodge2=position_dodge(width = 0.6)
jitter=position_jitter(width=0.1)

theme_set(theme_classic())

# set parameter labels
Tlab<-"Temperature (Â°C)"
alab<-expression(paste(italic("p"),"CO" [2]~ "("*mu,'atm)'))
dlab<-expression(paste("Symbiont density (10"^6,"cells cm"^-2,")"))
plab<-expression(paste("Total protein (mg cm"^-2,")"))
calab<-expression(paste("Carbohydrate (mg cm"^-2,")"))
clab<-expression(paste("Chlorophyll a ("*mu,"g cm"^-2,")"))
rlab<-expression(paste("Calcification rate (mg cm"^-2~"day"^-1,")"))
date <- Sys.Date() 
```


```{r, include=FALSE}
# Set up the dataframes
#phys <- read_csv("/Users/colleen/Dropbox/Boston_Experiment/Physiology/phys_R_code/16Jul16 Update/phys_all_25Jul19.csv")
#
#carb <- read_csv("~/Dropbox/Boston_Experiment/Physiology/Carbohydrate/Calculated_Carbs/Carb_final_10Aug19.csv")
#carb <- carb[,c(2,22)]
#
#df<-phys %>% 
#  left_join(carb, by=c("coral" = "coral"))

#write.csv(df, file="phys_all_13Aug19.csv")  
df <- read_csv("phys_all_13Aug19.csv")

df$X1 <- NULL
names(df)[38]<-"carb"
df$ftemp <- as.factor(df$ftemp)
df$fpco2 <- as.factor(df$fpco2)
df$colony <- as.factor(df$colony)
df$species <- factor(df$species, levels = c("S", "P", "A", "T"))
df$fpco2 <- factor(df$fpco2, c("280", "400", "700", "2800"))
df$den <- df$den / 1000000
df$treat[df$T0_T90 == "T0"] <- "control"
df$treat <- factor(df$treat, c("control", "288_28", "311_31", "447_28", "405_31", "673_28", "701_31", "3285_28", "3309_31"))
```


# T0 samples parameter plots 
<font color='darkmagenta'>Coloured points are individual samples with the black cross as the mean with the 95% CI</font> 
```{r, echo=FALSE, fig.height = 4, fig.width = 10, fig.align = "center", results = 'hide'}
T0.df <- subset(df, T0_T90=="T0") # dataframe of T0 only
T0.df <- T0.df[,c(1:16,38)]


T0.df <- gather(T0.df, param, value, den:carb) # make column of parameter and value
T0.df$param <- factor(T0.df$param, levels = c("pro", "carb", "den", "chla"))

T0.sum <- summarySE(data = T0.df, measurevar = "value", groupvars = c("param", "species"), na.rm = T)

T0.fig <- ggplot()+
  theme(panel.grid.major=element_blank(), legend.position="none", panel.grid.minor=element_blank(), panel.background=element_blank(),legend.key=element_blank(),strip.background = element_blank(), strip.placement = "outside", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  xlab("Species")+
  ylab("")+
geom_point(data=T0.df, aes(x=species, y=value, colour=col, shape = reef),size = 2, position=dodge)+
  geom_linerange(data=T0.sum, aes(x = species, ymin = value - ci, ymax = value + ci))+
  geom_point(data=T0.sum, aes(x=species, y=value), shape=95, colour="black", size = 7)+
  facet_wrap(~param, scales = "free_y",strip.position = "left", labeller = as_labeller( c(chla = "Chlorophyll \n (ug/cm2)", den = "Symbiont Density \n (10^6 cells cm2)", pro = "Total Protein \n (mg/cm2)", carb = "Carbohydrate \n (mg/cm2)", S = "SSID", P = "PSTR", A = "PAST", T = "UTEN")))
T0.fig


#fig <- paste("T0.fig", date, sep="_") 
#fig <- paste(fig, ".pdf", sep="") 
#
#pdf(fig, width = 7, height = 3)
#T0.fig
#dev.set(dev.next())
```


# Comparing T0 samples with T90 samples
<font color='darkmagenta'>Points are the mean with the bars representing standard error</font> 
```{r, echo=FALSE, fig.height = 16, fig.width = 10, fig.align = "center", results = 'hide'}
df2 <- df[,c(1:16,38)]
df.comp <- gather(df2, param, value, den:carb) # make column of parameter and value
df.comp$param <- factor(df.comp$param, levels = c("pro", "carb", "den", "chla"))


# make a 'treat' column for better spacing of plot
df.comp$treat2 <- df.comp$treat
df.comp$treat <- gsub("control", 2, df.comp$treat)
df.comp$treat <- gsub("288_28", 4, df.comp$treat)
df.comp$treat <- gsub("311_31", 4.5, df.comp$treat)
df.comp$treat <- gsub("447_28", 6, df.comp$treat)
df.comp$treat <- gsub("405_31", 6.5, df.comp$treat)
df.comp$treat <- gsub("673_28", 8, df.comp$treat)
df.comp$treat <- gsub("701_31", 8.5, df.comp$treat)
df.comp$treat <- gsub("3285_28", 10, df.comp$treat)
df.comp$treat <- gsub("3309_31", 10.5, df.comp$treat)

df.comp$treat <- as.numeric(df.comp$treat)


comp.sum <- summarySE(data = df.comp, measurevar = "value", groupvars = c("param", "species", "treat", "T0_T90", "treat2"), na.rm = TRUE)

comp.fig <-ggplot(comp.sum, aes(colour=treat2, shape = treat2))+
  theme(legend.position="bottom", panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.placement = "outside", panel.border = element_rect(colour = "black", fill=NA, size=1), axis.text.x = element_text(angle=45))+
  scale_x_discrete(breaks=c(2, 4, 6, 8, 10))+
  ylab("")+
  geom_vline(xintercept = 3)+
  geom_point(data=df.comp, aes(treat, value), position = dodge2, alpha=0.3, size=1)+
  geom_linerange(aes(x = treat, ymin=value-se, ymax=value+se, colour=treat2), position=dodge2)+
  geom_point(aes(treat, value), position = dodge2, size=2)+
  scale_colour_manual("Treatment", labels=c("control", "280_28", "280_31", "400_28", "400_31", "700_28", "700_31", "2800_28", "2800_31"), values = c("#009E73", "#0072B2", "#D55E00", "#0072B2", "#D55E00", "#0072B2", "#D55E00", "#0072B2", "#D55E00"))+
  scale_shape_manual("Treatment", labels=c("control", "280_28", "280_31", "400_28", "400_31", "700_28", "700_31", "2800_28", "2800_31"), values = c(8, 18, 18, 15, 15, 16, 16, 17, 17))+
  facet_wrap(param~species, scales = "free", strip.position = "top", labeller = as_labeller( c(chla = "Chlorophyll \n (ug/cm2)", den = "Symbiont Density \n (10^6 cells cm2)", pro = "Total Protein \n (mg/cm2)", carb = "Carbohydrate \n (mg/cm2)", S = "SSID", P = "PSTR", A = "PAST", T = "UTEN")))


comp.fig

# make cowplot of all coral images
s <- cowplot::ggdraw() + cowplot::draw_image("SSID.png", scale = 0.9) 
p <- cowplot::ggdraw() + cowplot::draw_image("PSTR.png", scale = 0.9)
a <- cowplot::ggdraw() + cowplot::draw_image("PAST.png", scale = 0.9)
u <- cowplot::ggdraw() + cowplot::draw_image("UTEN.png", scale = 0.9)
corals <- cowplot::plot_grid(s, p, a, u, ncol = 4)

# full T0 plot with coral images
full.T0.fig <- plot_grid(corals, comp.fig, ncol = 1, align = "v", axis = 'lb', rel_heights = c(3,12))
full.T0.fig


#
#fig2 <- paste("T0_T90_fig", date, sep="_") 
#fig2 <- paste(fig2, ".pdf", sep="") 
#
#pdf(fig2, width = 7, height = 7)
#comp.fig
#dev.set(dev.next())
```


# Total Protein Model Estimates and 95% CI
```{r, echo=FALSE, fig.height = 2, fig.width = 10, fig.align = "center", results = 'hide', message=FALSE}
#modify dataframe
T90.df <- df[,c(1:18,38)]
T90.df <- subset(T90.df, T0_T90=="T90")
T90.df$sum_bw5 <- T90.df$sum_bw5  * -1
T90.df <- gather(T90.df, param, value, den:carb) # make column of parameter and value
T90.df$param <- factor(T90.df$param, levels = c("pro", "carb", "den", "chla", "sum_bw5"))
T90.df$fpco2 <- factor(T90.df$fpco2, c("280", "400", "700", "2800"))
T90.df$species <- revalue(x = T90.df$species, c("S" = "SSID", "P" = "PSTR", 
  "A" = "PAST", "T" = "UTEN"))


T90.df.pro <- subset(T90.df, param=="pro")
#T90.df.pro <- subset(T90.df.pro2, species != "UTEN")

# this function remove rows with any missing values
completeFun <- function(data, desiredCols) {
  completeVec <- complete.cases(data[, desiredCols])
  return(data[completeVec, ])
}
T90.df.pro <- completeFun(T90.df.pro, "value") # run function to remove any missing values from "rate"

# mixed effect model run using lmer()
T90.pro.model <- lmer(value ~ species * (fpco2 + ftemp) + (1 | colony), REML=F, data = T90.df.pro)

summary(T90.pro.model) # view summary of model

### Performing the parametric bootstrapping of the model:

bootnum = 1500 # set number of iterations (we used 1500) between 999 and 9999
seed = 4 #seed to make results replicatable (our seed was 4)

out <- simulate(T90.pro.model,nsim=bootnum,seed=seed,re.form=NULL) # simulate your model set number of times in a dataframe (samples using random effects)
boots <- apply(out,2,function(x) predict(lmer(x ~ species * (fpco2 + ftemp) + (1 | colony), REML=F, data = T90.df.pro),re.form=NA)) # applies the predict (does not use random effects) FUNCTION to the columns of the 'out' dataframe to ...

boots <- cbind(predict(T90.pro.model,re.form=NA), boots) #combines boots matrix created above with the predicted values based on the model into a single matrix
T90.df.pro.a <- (cbind(T90.df.pro, as.data.frame(t(apply(boots, 1, function(x) c(mean(x), quantile(x, c(0.025, 0.975)))))))) #estimates mean and 95% confidence intercals for the prediction values and adds them to your new dataframe

head(T90.df.pro.a) # view your new dataframe so you can rename the mean and CI columns
colnames(T90.df.pro.a)[16:18] <- c("mean", "lowerci", "upperci") # rename mean/CI columns



ggplot(T90.df.pro.a)+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.placement = "outside", legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  ylab("total protein (mg / cm2)")+
  xlab("pCO2")+
  geom_point(aes(fpco2, value, colour=ftemp), position = dodge2, alpha = 0.3, shape = 17)+
  geom_linerange(aes(x=fpco2, ymin=lowerci, ymax=upperci, colour=ftemp), position = dodge, size = 1)+
  scale_color_manual("Temperature", values = c("blue", "red"))+
  facet_wrap(~species, scales = "free_y", ncol=4)
```


# Carbohydrate Model Estimates and 95% CI
```{r, echo=FALSE, fig.height = 2, fig.width = 10, fig.align = "center", results = 'hide', message=FALSE}
T90.df.carb <- subset(T90.df, param=="carb")
#T90.df.carb <- subset(T90.df.carb2, species != "UTEN")

# this function remove rows with any missing values
completeFun <- function(data, desiredCols) {
  completeVec <- complete.cases(data[, desiredCols])
  return(data[completeVec, ])
}
T90.df.carb <- completeFun(T90.df.carb, "value") # run function to remove any missing values from "rate"

# mixed effect model run using lmer()
T90.carb.model <- lmer(value ~ species + fpco2 + ftemp + (1 | colony), REML=F, data = T90.df.carb)

summary(T90.carb.model) # view summary of model

### Performing the parametric bootstrapping of the model:

out <- simulate(T90.carb.model,nsim=bootnum,seed=seed,re.form=NULL) # simulate your model set number of times in a dataframe (samples using random effects)
boots <- apply(out,2,function(x) predict(lmer(x ~ species + fpco2 + ftemp + (1 | colony), REML=F, data = T90.df.carb),re.form=NA)) # applies the predict (does not use random effects) FUNCTION to the columns of the 'out' dataframe to ...

boots <- cbind(predict(T90.carb.model,re.form=NA), boots) #combines boots matrix created above with the predicted values based on the model into a single matrix
T90.df.carb.a <- (cbind(T90.df.carb, as.data.frame(t(apply(boots, 1, function(x) c(mean(x), quantile(x, c(0.025, 0.975)))))))) #estimates mean and 95% conficarbce intercals for the prediction values and adds them to your new dataframe

head(T90.df.carb.a) # view your new dataframe so you can rename the mean and CI columns
colnames(T90.df.carb.a)[16:18] <- c("mean", "lowerci", "upperci") # rename mean/CI columns



ggplot(T90.df.carb.a)+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.placement = "outside", legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  ylab("Carbohydrate (mg / cm2)")+
  xlab("pCO2")+
  geom_point(aes(fpco2, value, colour=ftemp), position = dodge2, alpha = 0.3, shape = 17)+
  geom_linerange(aes(x=fpco2, ymin=lowerci, ymax=upperci, colour=ftemp), position = dodge, size = 1)+
  scale_color_manual("Temperature", values = c("blue", "red"))+
  facet_wrap(~species, scales = "free_y", ncol=4)
```



# Symbiont Density Model Estimates and 95% CI
```{r, echo=FALSE, fig.height = 2, fig.width = 10, fig.align = "center", results = 'hide', message=FALSE}
T90.df.den <- subset(T90.df, param=="den")
#T90.df.den <- subset(T90.df.den2, species != "UTEN")

# this function remove rows with any missing values
completeFun <- function(data, desiredCols) {
  completeVec <- complete.cases(data[, desiredCols])
  return(data[completeVec, ])
}
T90.df.den <- completeFun(T90.df.den, "value") # run function to remove any missing values from "rate"

# mixed effect model run using lmer()
T90.den.model <- lmer(value ~ species + fpco2 + ftemp + (1 | colony), REML=F, data = T90.df.den)

summary(T90.den.model) # view summary of model

### Performing the parametric bootstrapping of the model:

out <- simulate(T90.den.model,nsim=bootnum,seed=seed,re.form=NULL) # simulate your model set number of times in a dataframe (samples using random effects)
boots <- apply(out,2,function(x) predict(lmer(x ~ species + fpco2 + ftemp + (1 | colony), REML=F, data = T90.df.den),re.form=NA)) # applies the predict (does not use random effects) FUNCTION to the columns of the 'out' dataframe to ...

boots <- cbind(predict(T90.den.model,re.form=NA), boots) #combines boots matrix created above with the predicted values based on the model into a single matrix
T90.df.den.a <- (cbind(T90.df.den, as.data.frame(t(apply(boots, 1, function(x) c(mean(x), quantile(x, c(0.025, 0.975)))))))) #estimates mean and 95% confidence intercals for the prediction values and adds them to your new dataframe

head(T90.df.den.a) # view your new dataframe so you can rename the mean and CI columns
colnames(T90.df.den.a)[16:18] <- c("mean", "lowerci", "upperci") # rename mean/CI columns



ggplot(T90.df.den.a)+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.placement = "outside", legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  ylab("Symbiont Density (10^6 cells / cm2)")+
  xlab("pCO2")+
  geom_point(aes(fpco2, value, colour=ftemp), position = dodge2, alpha = 0.3, shape = 17)+
  geom_linerange(aes(x=fpco2, ymin=lowerci, ymax=upperci, colour=ftemp), position = dodge, size = 1)+
  scale_color_manual("Temperature", values = c("blue", "red"))+
  facet_wrap(~species, scales = "free_y", ncol=4)
```



# Chlorophyll a Model Estimates and 95% CI
```{r, echo=FALSE, fig.height = 2, fig.width = 10, fig.align = "center", results = 'hide', message=FALSE}
T90.df.chla <- subset(T90.df, param=="chla")
#T90.df.chla <- subset(T90.df.chla2, species != "UTEN")

# this function remove rows with any missing values
completeFun <- function(data, desiredCols) {
  completeVec <- complete.cases(data[, desiredCols])
  return(data[completeVec, ])
}
T90.df.chla <- completeFun(T90.df.chla, "value") # run function to remove any missing values from "rate"

# mixed effect model run using lmer()
T90.chla.model <- lmer(value ~ species * fpco2 * ftemp + (1 | colony), REML=F, data = T90.df.chla)

summary(T90.chla.model) # view summary of model

### Performing the parametric bootstrapping of the model:

out <- simulate(T90.chla.model,nsim=bootnum,seed=seed,re.form=NULL) # simulate your model set number of times in a dataframe (samples using random effects)
boots <- apply(out,2,function(x) predict(lmer(x ~ species * fpco2 * ftemp + (1 | colony), REML=F, data = T90.df.chla),re.form=NA)) # applies the predict (does not use random effects) FUNCTION to the columns of the 'out' dataframe to ...

boots <- cbind(predict(T90.chla.model,re.form=NA), boots) #combines boots matrix created above with the predicted values based on the model into a single matrix
T90.df.chla.a <- (cbind(T90.df.chla, as.data.frame(t(apply(boots, 1, function(x) c(mean(x), quantile(x, c(0.025, 0.975)))))))) #estimates mean and 95% confichlace intercals for the prediction values and adds them to your new dataframe

head(T90.df.chla.a) # view your new dataframe so you can rename the mean and CI columns
colnames(T90.df.chla.a)[16:18] <- c("mean", "lowerci", "upperci") # rename mean/CI columns



ggplot(T90.df.chla.a)+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.placement = "outside", legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  ylab("Chlorophyll a (10^6 cells / cm2)")+
  xlab("pCO2")+
  geom_point(aes(fpco2, value, colour=ftemp, shape = reef), position = dodge2, alpha = 0.3, shape = 17)+
  geom_linerange(aes(x=fpco2, ymin=lowerci, ymax=upperci, colour=ftemp), position = dodge, size = 1)+
  scale_color_manual("Temperature", values = c("blue", "red"))+
  facet_wrap(~species, scales = "free_y", ncol=4)
```


# Colour Intensity Model Estimates and 95% CI
```{r, echo=FALSE, fig.height = 2, fig.width = 10, fig.align = "center", results = 'hide', message=FALSE}
T90.df.sum <- subset(T90.df, param=="sum_bw5")
#T90.df.sum <- subset(T90.df.sum2, species != "UTEN")

# this function remove rows with any missing values
completeFun <- function(data, desiredCols) {
  completeVec <- complete.cases(data[, desiredCols])
  return(data[completeVec, ])
}
T90.df.sum <- completeFun(T90.df.sum, "value") # run function to remove any missing values from "rate"

# mixed effect model run using lmer()
T90.sum.model <- lmer(value ~ species * (fpco2 + ftemp) + (1 | colony), REML=F, data = T90.df.sum)

summary(T90.sum.model) # view summary of model

### Performing the parametric bootstrapping of the model:

out <- simulate(T90.sum.model,nsim=bootnum,seed=seed,re.form=NULL) # simulate your model set number of times in a dataframe (samples using random effects)
boots <- apply(out,2,function(x) predict(lmer(x ~ species * (fpco2 + ftemp) + (1 | colony), REML=F, data = T90.df.sum),re.form=NA)) # applies the predict (does not use random effects) FUNCTION to the columns of the 'out' dataframe to ...

boots <- cbind(predict(T90.sum.model,re.form=NA), boots) #combines boots matrix created above with the predicted values based on the model into a single matrix
T90.df.sum.a <- (cbind(T90.df.sum, as.data.frame(t(apply(boots, 1, function(x) c(mean(x), quantile(x, c(0.025, 0.975)))))))) #estimates mean and 95% confisumce intercals for the prediction values and adds them to your new dataframe

head(T90.df.sum.a) # view your new dataframe so you can rename the mean and CI columns
colnames(T90.df.sum.a)[16:18] <- c("mean", "lowerci", "upperci") # rename mean/CI columns



ggplot(T90.df.sum.a)+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.placement = "outside", legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  ylab("Chlorophyll a (10^6 cells / cm2)")+
  xlab("pCO2")+
  geom_point(aes(fpco2, value, colour=ftemp, shape = reef), position = dodge2, alpha = 0.3, shape = 17)+
  geom_linerange(aes(x=fpco2, ymin=lowerci, ymax=upperci, colour=ftemp), position = dodge, size = 1)+
  scale_color_manual("Temperature", values = c("blue", "red"))+
  facet_wrap(~species, scales = "free_y", ncol=4)
```




#T90 plot of all parameters 
<font color='darkmagenta'>Plotting physiology</font> 
```{r, include=FALSE, fig.height = 10, fig.width = 9, fig.align = "center", results = 'hide'}
# create summary data
T90.sum <- summarySE(data = T90.df, measurevar = "value", groupvars = c("param", "species", "fpco2", "ftemp"), na.rm = TRUE)

# plot total protein
pro.T90.sum <- subset(T90.sum, param=="pro")
pro.T90 <- subset(T90.df, param=="pro")

pro.T90.fig <-ggplot(pro.T90.sum, aes(colour=ftemp, group=ftemp))+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.placement = "outside", legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  ylab("total protein")+
  xlab("")+
  geom_point(data=pro.T90, aes(fpco2, value), position = jitter, alpha=0.3, size=1)+
  geom_errorbar(aes(x = fpco2, ymin=value-se, ymax=value+se, width=0.5), position=dodge2, colour="black")+
  geom_point(aes(fpco2, value), position = dodge2, size=2, shape = 15)+
  scale_colour_manual("Temperature", labels=c("28C", "31C"), values = c("blue", "red"))+
  facet_wrap(~species, scales = "free_y", ncol=4)

# plot carbohydrate
carb.T90.sum <- subset(T90.sum, param=="carb")
carb.T90 <- subset(T90.df, param=="carb")

carb.T90.fig <-ggplot(carb.T90.sum, aes(colour=ftemp, group=ftemp))+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.text.x = element_blank(), legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  ylab("carbohydrate")+
  xlab("")+
  geom_point(data=carb.T90, aes(fpco2, value), position = jitter, alpha=0.3, size=1)+
  geom_errorbar(aes(x = fpco2, ymin=value-se, ymax=value+se, width=0.5), position=dodge2, colour="black")+
  geom_point(aes(fpco2, value), position = dodge2, size=2, shape = 15)+
  scale_colour_manual("Temperature", labels=c("28C", "31C"), values = c("blue", "red"))+
  facet_wrap(~species, scales = "free_y", ncol=4)

# plot symbiont density
den.T90.sum <- subset(T90.sum, param=="den")
den.T90 <- subset(T90.df, param=="den")

den.T90.fig <-ggplot(den.T90.sum, aes(colour=ftemp, group=ftemp))+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.text.x = element_blank(), legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  ylab("symb. density")+
  xlab("")+  
  geom_point(data=den.T90, aes(fpco2, value), position = jitter, alpha=0.3, size=1)+
  geom_errorbar(aes(x = fpco2, ymin=value-se, ymax=value+se, width=0.5), position=dodge2, colour="black")+
  geom_point(aes(fpco2, value), position = dodge2, size=2, shape = 15)+
  scale_colour_manual("Temperature", labels=c("28C", "31C"), values = c("blue", "red"))+
  facet_wrap(~species, scales = "free_y", ncol=4)

# plot chlorophyll
chla.T90.sum <- subset(T90.sum, param=="chla")
chla.T90 <- subset(T90.df, param=="chla")

chla.T90.fig <-ggplot(chla.T90.sum, aes(colour=ftemp, group=ftemp))+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.text.x = element_blank(), legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  xlab("")+
  ylab("chlorophyll")+
  geom_point(data=chla.T90, aes(fpco2, value), position = jitter, alpha=0.3, size=1)+
  geom_errorbar(aes(x = fpco2, ymin=value-se, ymax=value+se, width=0.5), position=dodge2, colour="black")+
  geom_point(aes(fpco2, value), position = dodge2, size=2, shape = 15)+
  scale_colour_manual("Temperature", labels=c("28C", "31C"), values = c("blue", "red"))+
  facet_wrap(~species, scales = "free_y", ncol=4)

# plot colour intensity
sum_bw5.T90.sum <- subset(T90.sum, param=="sum_bw5")
sum_bw5.T90 <- subset(T90.df, param=="sum_bw5")

sum_bw5.T90.fig <-ggplot(sum_bw5.T90.sum, aes(colour=ftemp, group=ftemp))+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.text.x = element_blank(), legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  xlab(alab)+
  ylab("colour intensity")+
  geom_point(data=sum_bw5.T90, aes(fpco2, value), position = jitter, alpha=0.3, size=1)+
  geom_errorbar(aes(x = fpco2, ymin=value-se, ymax=value+se, width=0.5), position=dodge2, colour="black")+
  geom_point(aes(fpco2, value), position = dodge2, size=2, shape = 15)+
  scale_colour_manual("Temperature", labels=c("28C", "31C"), values = c("blue", "red"))+
  facet_wrap(~species, scales = "free_y", ncol=4)


# Combine all the plots
phys_plot<- plot_grid(pro.T90.fig, carb.T90.fig, den.T90.fig, chla.T90.fig, sum_bw5.T90.fig, ncol = 1, labels = c('A', 'B', 'C', 'D', 'E'), label_size = 12)
phys_plot
#
## Create figure name
#fig3 <- paste("T90_noCol_fig", date, sep="_") 
#fig3 <- paste(fig3, ".pdf", sep="") 
#
## save figure as PDF
#pdf(fig3, width = 7, height = 8)
#phys_plot
#dev.set(dev.next())
```

<font color='darkmagenta'>Plotting sum colour intensity metrics</font>  
```{r, echo=FALSE, fig.height = 7, fig.width = 11, fig.align = "center", results = 'hide'}
col.df <- df[,c(1:12,17:36)]
col.df <- col.df[,c(1:13,17,21,25,29)]
col.df <- subset(col.df, T0_T90=="T90")
col.df <- gather(col.df, col.metric, value, sum_bw5:sum_bw4) # make column of parameter and value
col.df$col.metric <- gsub("sum_bw", "tp", col.df$col.metric)
col.df$value <- col.df$value * -1
col.df$fpco2 <- factor(col.df$fpco2, c("280", "400", "700", "2800"))

col.sum <- summarySE(data = col.df, measurevar = "value", groupvars = c("col.metric", "species", "fpco2", "ftemp"), na.rm = TRUE)

colour.fig <-ggplot(col.sum, aes(colour=ftemp, group=ftemp))+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.placement = "outside", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  geom_point(data=col.df, aes(col.metric, value), position = jitter, alpha=0.3, size=1.5, shape = 20)+
  geom_line(aes(col.metric, value), position = dodge, size=0.5)+
  xlab("time point")+
  ylab("")+
  geom_errorbar(aes(x = col.metric, ymin=value-se, ymax=value+se, width=0.3), position=dodge, colour="black")+
  geom_point(aes(col.metric, value), position = dodge, size=2)+
  scale_colour_manual("Temperature", labels=c("28C", "31C"), values = c("blue", "red"))+
  facet_grid(species~fpco2, scales = "free_y", labeller = as_labeller( c(S = "SSID", P = "PSTR", A = "PAST", T = "UTEN", "280" = "280 uatm", "400" = "400 uatm", "700" = "700 uatm", "2800" = "2800 uatm")))
  #facet_grid(col.metric~species, scales = "free_y", labeller = as_labeller( c(S = "SSID", P = "PSTR", A = "PAST", T = "UTEN", sum_bw1 = "Pre-Acc (sum)", sum_bw2 = "T0 (sum)", sum_bw3 = "T30 (sum)", sum_bw4 = "T60 (sum)", sum_bw5 = "T90 (sum)")))
colour.fig


#fig4 <- paste("colour_fig", date, sep="_") 
#fig4 <- paste(fig4, ".pdf", sep="") 
#
#pdf(fig4, width = 7, height = 5)
#colour.fig
#dev.set(dev.next())
```


## Preliminary statistics (basic linear model and anova)
```{r, echo = FALSE}
# Select for only T90 values and remove excess colour intensity columns (only sum_T90)
df.stat <- subset(df, T0_T90=="T90")
df.stat <- df.stat[,-c(18:36)]
df.stat$fpco2 <- factor(df.stat$fpco2, levels = c("400", "280", "700", "2800"))
df.stat$sum.in <- df.stat$sum_bw5 * -1

sid.stat <- subset(df.stat, species=="S")
dip.stat <- subset(df.stat, species=="P")
por.stat <- subset(df.stat, species=="A")
ten.stat <- subset(df.stat, species=="T")

# Basic linear models for SSID
sid.carb.lm <- lm <- lm(carb ~ ftemp + fpco2 + reef, data=sid.stat)
sid.pro.lm <- lm <- lm(pro ~ ftemp + fpco2 + reef + reef:ftemp, data=sid.stat)
sid.den.lm <- lm <- lm(den ~ ftemp + fpco2 + reef + reef:ftemp, data=sid.stat)
sid.chla.lm <- lm <- lm(chla ~ ftemp + fpco2 + reef, data=sid.stat)
sid.col.lm <- lm <- lm(sum.in ~ ftemp + fpco2 + reef, data=sid.stat)


sid.stat.df <- data.frame("Parameter" = c("Carbohydrate", "Protein", "Symbiont Density", "Chlorophyll a", "Colour Intensity"))

sid.stat.df$`Temperature` <- round(c(summary(sid.carb.lm)$coefficients[2,4],
                                       summary(sid.pro.lm)$coefficients[2,4],
                                       summary(sid.den.lm)$coefficients[2,4], 
                                       summary(sid.chla.lm)$coefficients[2,4],
                                       summary(sid.col.lm)$coefficients[2,4]), 4)

sid.stat.df$`280 pCO2` <- round(c(summary(sid.carb.lm)$coefficients[3,4],
                                       summary(sid.pro.lm)$coefficients[3,4],
                                       summary(sid.den.lm)$coefficients[3,4], 
                                       summary(sid.chla.lm)$coefficients[3,4],
                                       summary(sid.col.lm)$coefficients[3,4]), 4)

sid.stat.df$`700 pCO2` <- round(c(summary(sid.carb.lm)$coefficients[4,4],
                                       summary(sid.pro.lm)$coefficients[4,4],
                                       summary(sid.den.lm)$coefficients[4,4], 
                                       summary(sid.chla.lm)$coefficients[4,4],
                                       summary(sid.col.lm)$coefficients[4,4]), 4)

sid.stat.df$`2800 pCO2` <- round(c(summary(sid.carb.lm)$coefficients[5,4],
                                       summary(sid.pro.lm)$coefficients[5,4],
                                       summary(sid.den.lm)$coefficients[5,4], 
                                       summary(sid.chla.lm)$coefficients[5,4],
                                       summary(sid.col.lm)$coefficients[5,4]), 4)

sid.stat.df$`Reef Environment` <- round(c(summary(sid.carb.lm)$coefficients[6,4],
                                       summary(sid.pro.lm)$coefficients[6,4],
                                       summary(sid.den.lm)$coefficients[6,4], 
                                       summary(sid.chla.lm)$coefficients[6,4],
                                       summary(sid.col.lm)$coefficients[6,4]), 4)    

sid.stat.df$`Temperature x Reef` <-  c("NA",
                                       round(summary(sid.pro.lm)$coefficients[7,4], 4),
                                       round(summary(sid.den.lm)$coefficients[7,4], 4), 
                                       "NA",
                                       "NA")   

sid.stat.df2 <- data.frame(t(sid.stat.df[-1]))
colnames(sid.stat.df2) <- sid.stat.df[, 1]

sid.stat.df2$Carbohydrate <- as.numeric(as.character(sid.stat.df2$Carbohydrate))
sid.stat.df2$Protein <- as.numeric(as.character(sid.stat.df2$Protein))
sid.stat.df2$`Symbiont Density` <- as.numeric(as.character(sid.stat.df2$`Symbiont Density`))
sid.stat.df2$`Chlorophyll a` <- as.numeric(as.character(sid.stat.df2$`Chlorophyll a`))
sid.stat.df2$`Colour Intensity` <- as.numeric(as.character(sid.stat.df2$`Colour Intensity`))

kable(sid.stat.df2, caption = "SSID linear models p-values") %>%
  kable_styling(font_size = 12, full_width = F) %>% 
  row_spec(0, background = "lightgrey") %>% 
  column_spec(1, italic = T, color = "black", background = "lightgrey") %>% 
  column_spec(2:3, color = "#333333", background ="#FF9999") %>%
  column_spec(4:6, color = "#333333", background = "#99CC66")

```

```{r, echo = FALSE}
# Basic linear models for PSTR
dip.carb.lm <- lm <- lm(carb ~ ftemp + fpco2 + reef, data=dip.stat)
dip.pro.lm <- lm <- lm(pro ~ ftemp + fpco2 + reef, data=dip.stat)
dip.den.lm <- lm <- lm(den ~ ftemp + fpco2 + reef + ftemp:reef, data=dip.stat)
dip.chla.lm <- lm <- lm(chla ~ ftemp + fpco2 + reef, data=dip.stat)
dip.col.lm <- lm <- lm(sum.in ~ ftemp + fpco2 + reef + ftemp:reef, data=dip.stat)


dip.stat.df <- data.frame("Parameter" = c("Carbohydrate", "Protein", "Symbiont Density", "Chlorophyll a", "Colour Intensity"))

dip.stat.df$`Temperature` <- round(c(summary(dip.carb.lm)$coefficients[2,4],
                                       summary(dip.pro.lm)$coefficients[2,4],
                                       summary(dip.den.lm)$coefficients[2,4], 
                                       summary(dip.chla.lm)$coefficients[2,4],
                                       summary(dip.col.lm)$coefficients[2,4]), 4)

dip.stat.df$`280 pCO2` <- round(c(summary(dip.carb.lm)$coefficients[3,4],
                                       summary(dip.pro.lm)$coefficients[3,4],
                                       summary(dip.den.lm)$coefficients[3,4], 
                                       summary(dip.chla.lm)$coefficients[3,4],
                                       summary(dip.col.lm)$coefficients[3,4]), 4)

dip.stat.df$`700 pCO2` <- round(c(summary(dip.carb.lm)$coefficients[4,4],
                                       summary(dip.pro.lm)$coefficients[4,4],
                                       summary(dip.den.lm)$coefficients[4,4], 
                                       summary(dip.chla.lm)$coefficients[4,4],
                                       summary(dip.col.lm)$coefficients[4,4]), 4)

dip.stat.df$`2800 pCO2` <- round(c(summary(dip.carb.lm)$coefficients[5,4],
                                       summary(dip.pro.lm)$coefficients[5,4],
                                       summary(dip.den.lm)$coefficients[5,4], 
                                       summary(dip.chla.lm)$coefficients[5,4],
                                       summary(dip.col.lm)$coefficients[5,4]), 4)

dip.stat.df$`Reef Environment` <- round(c(summary(dip.carb.lm)$coefficients[6,4],
                                       summary(dip.pro.lm)$coefficients[6,4],
                                       summary(dip.den.lm)$coefficients[6,4], 
                                       summary(dip.chla.lm)$coefficients[6,4],
                                       summary(dip.col.lm)$coefficients[6,4]), 4)    

dip.stat.df$`Temperature x Reef` <-  c("NA",
                                       "NA",
                                       round(summary(dip.den.lm)$coefficients[7,4], 4), 
                                       "NA",
                                       round(summary(dip.col.lm)$coefficients[7,4], 4))  

dip.stat.df2 <- data.frame(t(dip.stat.df[-1]))
colnames(dip.stat.df2) <- dip.stat.df[, 1]

dip.stat.df2$Carbohydrate <- as.numeric(as.character(dip.stat.df2$Carbohydrate))
dip.stat.df2$Protein <- as.numeric(as.character(dip.stat.df2$Protein))
dip.stat.df2$`Symbiont Density` <- as.numeric(as.character(dip.stat.df2$`Symbiont Density`))
dip.stat.df2$`Chlorophyll a` <- as.numeric(as.character(dip.stat.df2$`Chlorophyll a`))
dip.stat.df2$`Colour Intensity` <- as.numeric(as.character(dip.stat.df2$`Colour Intensity`))

kable(dip.stat.df2, caption = "PSTR linear models p-values") %>%
  kable_styling(font_size = 12, full_width = F) %>% 
  row_spec(0, background = "lightgrey") %>% 
  column_spec(1, italic = T, color = "black", background = "lightgrey") %>% 
  column_spec(2:3, color = "#333333", background ="#FF9999") %>%
  column_spec(4:6, color = "#333333", background = "#99CC66")

```

```{r, echo = FALSE}
# Basic linear models for PAST
por.carb.lm <- lm <- lm(carb ~ ftemp + fpco2 + reef, data=por.stat)
por.pro.lm <- lm <- lm(pro ~ ftemp + fpco2 + reef, data=por.stat)
por.den.lm <- lm <- lm(den ~ ftemp + fpco2 + reef , data=por.stat)
por.chla.lm <- lm <- lm(chla ~ ftemp + fpco2 + reef + ftemp:fpco2, data=por.stat)
por.col.lm <- lm <- lm(sum.in ~ ftemp + fpco2 + reef, data=por.stat)


por.stat.df <- data.frame("Parameter" = c("Carbohydrate", "Protein", "Symbiont Density", "Chlorophyll a", "Colour Intensity"))

por.stat.df$`Temperature` <- round(c(summary(por.carb.lm)$coefficients[2,4],
                                       summary(por.pro.lm)$coefficients[2,4],
                                       summary(por.den.lm)$coefficients[2,4], 
                                       summary(por.chla.lm)$coefficients[2,4],
                                       summary(por.col.lm)$coefficients[2,4]), 4)

por.stat.df$`280 pCO2` <- round(c(summary(por.carb.lm)$coefficients[3,4],
                                       summary(por.pro.lm)$coefficients[3,4],
                                       summary(por.den.lm)$coefficients[3,4], 
                                       summary(por.chla.lm)$coefficients[3,4],
                                       summary(por.col.lm)$coefficients[3,4]), 4)

por.stat.df$`700 pCO2` <- round(c(summary(por.carb.lm)$coefficients[4,4],
                                       summary(por.pro.lm)$coefficients[4,4],
                                       summary(por.den.lm)$coefficients[4,4], 
                                       summary(por.chla.lm)$coefficients[4,4],
                                       summary(por.col.lm)$coefficients[4,4]), 4)

por.stat.df$`2800 pCO2` <- round(c(summary(por.carb.lm)$coefficients[5,4],
                                       summary(por.pro.lm)$coefficients[5,4],
                                       summary(por.den.lm)$coefficients[5,4], 
                                       summary(por.chla.lm)$coefficients[5,4],
                                       summary(por.col.lm)$coefficients[5,4]), 4)

por.stat.df$`Reef Environment` <- round(c(summary(por.carb.lm)$coefficients[6,4],
                                       summary(por.pro.lm)$coefficients[6,4],
                                       summary(por.den.lm)$coefficients[6,4], 
                                       summary(por.chla.lm)$coefficients[6,4],
                                       summary(por.col.lm)$coefficients[6,4]), 4)    

por.stat.df$`Temperature x 280 pCO2` <-  c("NA",
                                       "NA",
                                       "NA", 
                                       summary(por.chla.lm)$coefficients[7,4],
                                       "NA")  

por.stat.df$`Temperature x 700 pCO2` <-  c("NA",
                                       "NA",
                                       "NA", 
                                       summary(por.chla.lm)$coefficients[8,4],
                                       "NA") 

por.stat.df$`Temperature x 2800 pCO2` <-  c("NA",
                                       "NA",
                                       "NA", 
                                       summary(por.chla.lm)$coefficients[9,4],
                                       "NA")  

por.stat.df2 <- data.frame(t(por.stat.df[-1]))
colnames(por.stat.df2) <- por.stat.df[, 1]

kable(por.stat.df2, caption = "PAST linear models p-values") %>%
  kable_styling(font_size = 12, full_width = F) %>% 
  row_spec(0, background = "lightgrey") %>% 
  column_spec(1, italic = T, color = "black", background = "lightgrey") %>% 
  column_spec(2:3, color = "#333333", background ="#FF9999") %>%
  column_spec(4:6, color = "#333333", background = "#99CC66")

```


```{r, echo = FALSE}
# Basic linear models for UTEN
ten.carb.lm <- lm <- lm(carb ~ ftemp + fpco2 + reef, data=ten.stat)
ten.pro.lm <- lm <- lm(pro ~ ftemp + fpco2 + reef, data=ten.stat)
ten.den.lm <- lm <- lm(den ~ ftemp + fpco2 + reef , data=ten.stat)
ten.chla.lm <- lm <- lm(chla ~ ftemp + fpco2 + reef, data=ten.stat)
ten.col.lm <- lm <- lm(sum.in ~ ftemp + fpco2 + reef, data=ten.stat)


ten.stat.df <- data.frame("Parameter" = c("Carbohydrate", "Protein", "Symbiont Density", "Chlorophyll a", "Colour Intensity"))

ten.stat.df$`Temperature` <- round(c(summary(ten.carb.lm)$coefficients[2,4],
                                       summary(ten.pro.lm)$coefficients[2,4],
                                       summary(ten.den.lm)$coefficients[2,4], 
                                       summary(ten.chla.lm)$coefficients[2,4],
                                       summary(ten.col.lm)$coefficients[2,4]), 4)

ten.stat.df$`280 pCO2` <- round(c(summary(ten.carb.lm)$coefficients[3,4],
                                       summary(ten.pro.lm)$coefficients[3,4],
                                       summary(ten.den.lm)$coefficients[3,4], 
                                       summary(ten.chla.lm)$coefficients[3,4],
                                       summary(ten.col.lm)$coefficients[3,4]), 4)

ten.stat.df$`700 pCO2` <- round(c(summary(ten.carb.lm)$coefficients[4,4],
                                       summary(ten.pro.lm)$coefficients[4,4],
                                       summary(ten.den.lm)$coefficients[4,4], 
                                       summary(ten.chla.lm)$coefficients[4,4],
                                       summary(ten.col.lm)$coefficients[4,4]), 4)

ten.stat.df$`2800 pCO2` <- round(c(summary(ten.carb.lm)$coefficients[5,4],
                                       summary(ten.pro.lm)$coefficients[5,4],
                                       summary(ten.den.lm)$coefficients[5,4], 
                                       summary(ten.chla.lm)$coefficients[5,4],
                                       summary(ten.col.lm)$coefficients[5,4]), 4)

ten.stat.df$`Reef Environment` <- round(c(summary(ten.carb.lm)$coefficients[6,4],
                                       summary(ten.pro.lm)$coefficients[6,4],
                                       summary(ten.den.lm)$coefficients[6,4], 
                                       summary(ten.chla.lm)$coefficients[6,4],
                                       summary(ten.col.lm)$coefficients[6,4]), 4)    


ten.stat.df2 <- data.frame(t(ten.stat.df[-1]))
colnames(ten.stat.df2) <- ten.stat.df[, 1]

kable(ten.stat.df2, caption = "UTEN linear models p-values") %>%
  kable_styling(font_size = 12, full_width = F) %>% 
  row_spec(0, background = "lightgrey") %>% 
  column_spec(1, italic = T, color = "black", background = "lightgrey") %>% 
  column_spec(2:3, color = "#333333", background ="#FF9999") %>%
  column_spec(4:6, color = "#333333", background = "#99CC66")

```




#T90 plot of all parameters by reefzone
```{r, echo=FALSE, fig.height = 10, fig.width = 9, fig.align = "center", results = 'hide'}
# create summary data
T90.reef.sum <- summarySE(data = T90.df, measurevar = "value", groupvars = c("param", "species", "fpco2", "ftemp", "reef"), na.rm = TRUE)

# plot total protein
pro.T90.reef.sum <- subset(T90.reef.sum, param=="pro")

pro.reef.T90.fig <-ggplot(pro.T90.reef.sum, aes(colour=reef, shape = ftemp, group=ftemp))+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.placement = "outside", legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  ylab("total protein")+
  xlab("")+
  geom_point(data=pro.T90, aes(fpco2, value), position = jitter, alpha=0.3, size=1)+
  geom_errorbar(aes(x = fpco2, ymin=value-se, ymax=value+se, width=0.5), position=dodge2, colour="black")+
  geom_point(aes(fpco2, value), position = dodge2, size=2)+
  scale_colour_manual("REef Environment", labels=c("Inshore", "Offshore"), values = c("darkgrey", "orange"))+
  facet_wrap(~species, scales = "free_y", ncol=4)

# plot carbohydrate
carb.T90.reef.sum <- subset(T90.reef.sum, param=="carb")

carb.reef.T90.fig <-ggplot(carb.T90.reef.sum, aes(colour=reef, shape = ftemp, group=ftemp))+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.text.x = element_blank(), legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  ylab("carbohydrate")+
  xlab("")+
  geom_point(data=carb.T90, aes(fpco2, value), position = jitter, alpha=0.3, size=1)+
  geom_errorbar(aes(x = fpco2, ymin=value-se, ymax=value+se, width=0.5), position=dodge2, colour="black")+
  geom_point(aes(fpco2, value), position = dodge2, size=2)+
  scale_colour_manual("REef Environment", labels=c("Inshore", "Offshore"), values = c("darkgrey", "orange"))+
  facet_wrap(~species, scales = "free_y", ncol=4)

# plot symbiont density
den.T90.reef.sum <- subset(T90.reef.sum, param=="den")

den.reef.T90.fig <-ggplot(den.T90.reef.sum, aes(colour=reef, shape = ftemp, group=ftemp))+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.text.x = element_blank(), legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  ylab("symb. density")+
  xlab("")+  
  geom_point(data=den.T90, aes(fpco2, value), position = jitter, alpha=0.3, size=1)+
  geom_errorbar(aes(x = fpco2, ymin=value-se, ymax=value+se, width=0.5), position=dodge2, colour="black")+
  geom_point(aes(fpco2, value), position = dodge2, size=2)+
  scale_colour_manual("REef Environment", labels=c("Inshore", "Offshore"), values = c("darkgrey", "orange"))+
  facet_wrap(~species, scales = "free_y", ncol=4)

# plot chlorophyll
chla.T90.reef.sum <- subset(T90.reef.sum, param=="chla")

chla.reef.T90.fig <-ggplot(chla.T90.reef.sum, aes(colour=reef, shape = ftemp, group=ftemp))+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.text.x = element_blank(), legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  xlab("")+
  ylab("chlorophyll")+
  geom_point(data=chla.T90, aes(fpco2, value), position = jitter, alpha=0.3, size=1)+
  geom_errorbar(aes(x = fpco2, ymin=value-se, ymax=value+se, width=0.5), position=dodge2, colour="black")+
  geom_point(aes(fpco2, value), position = dodge2, size=2)+
  scale_colour_manual("REef Environment", labels=c("Inshore", "Offshore"), values = c("darkgrey", "orange"))+
  facet_wrap(~species, scales = "free_y", ncol=4)

# plot colour intensity
sum_bw5.T90.reef.sum <- subset(T90.reef.sum, param=="sum_bw5")

sum_bw5.reef.T90.fig <-ggplot(sum_bw5.T90.reef.sum, aes(colour=reef, shape = ftemp, group=ftemp))+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.text.x = element_blank(), legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  xlab(alab)+
  ylab("colour intensity")+
  geom_point(data=sum_bw5.T90, aes(fpco2, value), position = jitter, alpha=0.3, size=1)+
  geom_errorbar(aes(x = fpco2, ymin=value-se, ymax=value+se, width=0.5), position=dodge2, colour="black")+
  geom_point(aes(fpco2, value), position = dodge2, size=2)+
  scale_colour_manual("REef Environment", labels=c("Inshore", "Offshore"), values = c("darkgrey", "orange"))+
  facet_wrap(~species, scales = "free_y", ncol=4)


# Combine all the plots
phys_reef_plot<- plot_grid(pro.reef.T90.fig, carb.reef.T90.fig, den.reef.T90.fig, chla.reef.T90.fig, sum_bw5.reef.T90.fig, ncol = 1, labels = c('A', 'B', 'C', 'D', 'E'), label_size = 12)
phys_reef_plot

## Create figure name
#fig5 <- paste("T90_reef_noCol_fig", date, sep="_") 
#fig5 <- paste(fig5, ".pdf", sep="") 
#
## save figure as PDF
#pdf(fig5, width = 7, height = 8)
#phys_reef_plot
#dev.set(dev.next())
```


# PCA of physiology at T90
```{r, echo=FALSE, fig.height = 4.5, fig.width = 7, fig.align = "center"}
df3 <- df[, -c(18:36)]
names(df3)[17]<-"sum"
pca.df <- na.omit(df3)

pca.out <- prcomp(pca.df[, c(14:19)], scale. = TRUE, centered = TRUE)

species.PCA <- autoplot(pca.out, data = pca.df, 
         colour = "species",
         frame = TRUE, frame.type = 'norm',
         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("Species", labels = c("SSID", "PSTR", "PAST", "UTEN"), values = c("orangered", "seagreen", "goldenrod3", "palevioletred3"))+
scale_fill_manual("Species", labels = c("SSID", "PSTR", "PAST", "UTEN"), values = c("orangered", "seagreen", "goldenrod3", "palevioletred3"))+
  ggtitle("All species")
species.PCA
```

```{r, echo=FALSE, fig.height = 2.7, fig.width = 9, fig.align = "center"}
######## SSID only
s.df <- subset(pca.df, species=="S")
sid.pca.out <- prcomp(s.df[, c(14:19)], scale. = TRUE, center = TRUE)

sid.pco2.PCA <- autoplot(sid.pca.out, data = s.df, 
                         colour = "fpco2",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("280 uatm", "400 uatm", "700 uatm", "2800 uatm"), values = c("#2c7bb6", "#abd9e9", "#fdae61", "#d7191c"))+
  scale_fill_manual("", labels = c("280 uatm", "400 uatm", "700 uatm", "2800 uatm"), values = c("#2c7bb6", "#abd9e9", "#fdae61", "#d7191c"))+
  ggtitle("SSID by pCO2")



sid.temp.PCA <- autoplot(sid.pca.out, data = s.df, 
                         colour = "ftemp",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("28C", "31C"), values = c("blue", "red"))+
  scale_fill_manual("", labels = c("28C", "31C"), values = c("blue", "red"))+
  ggtitle("SSID by temperature")



sid.reef.PCA <- autoplot(sid.pca.out, data = s.df, 
                         colour = "reef",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("Offshore", "Inshore"), values = c("turquoise", "brown"))+
  scale_fill_manual("", labels = c("Offshore", "Inshore"), values = c("turquoise", "brown"))+
  ggtitle("SSID by reef environment")


sid.pca.plot <- plot_grid(sid.pco2.PCA, sid.temp.PCA, sid.reef.PCA, ncol=3)
sid.pca.plot


######## PSTR only
p.df <- subset(pca.df, species=="P")
dip.pca.out <- prcomp(p.df[, c(14:19)], scale. = TRUE, center = TRUE)

dip.pco2.PCA <- autoplot(dip.pca.out, data = p.df, 
                         colour = "fpco2",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("280 uatm", "400 uatm", "700 uatm", "2800 uatm"), values = c("#2c7bb6", "#abd9e9", "#fdae61", "#d7191c"))+
  scale_fill_manual("", labels = c("280 uatm", "400 uatm", "700 uatm", "2800 uatm"), values = c("#2c7bb6", "#abd9e9", "#fdae61", "#d7191c"))+
  ggtitle("PSTR by pCO2")


dip.temp.PCA <- autoplot(dip.pca.out, data = p.df, 
                         colour = "ftemp",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("28C", "31C"), values = c("blue", "red"))+
  scale_fill_manual("", labels = c("28C", "31C"), values = c("blue", "red"))+
  ggtitle("PSTR by temperature")


dip.reef.PCA <- autoplot(dip.pca.out, data = p.df, 
                         colour = "reef",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("Offshore", "Inshore"), values = c("turquoise", "brown"))+
  scale_fill_manual("", labels = c("Offshore", "Inshore"), values = c("turquoise", "brown"))+
  ggtitle("PSTR by reef environment")


dip.pca.plot <- plot_grid(dip.pco2.PCA, dip.temp.PCA, dip.reef.PCA, ncol=3)
dip.pca.plot


######## PAST only
a.df <- subset(pca.df, species=="A")
por.pca.out <- prcomp(a.df[, c(14:19)], scale. = TRUE, center = TRUE)

por.pco2.PCA <- autoplot(por.pca.out, data = a.df, 
                         colour = "fpco2",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("280 uatm", "400 uatm", "700 uatm", "2800 uatm"), values = c("#2c7bb6", "#abd9e9", "#fdae61", "#d7191c"))+
  scale_fill_manual("", labels = c("280 uatm", "400 uatm", "700 uatm", "2800 uatm"), values = c("#2c7bb6", "#abd9e9", "#fdae61", "#d7191c"))+
  ggtitle("PAST by pCO2")


por.temp.PCA <- autoplot(por.pca.out, data = a.df, 
                         colour = "ftemp",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("28C", "31C"), values = c("blue", "red"))+
  scale_fill_manual("", labels = c("28C", "31C"), values = c("blue", "red"))+
  ggtitle("PAST by temperature")


por.reef.PCA <- autoplot(por.pca.out, data = a.df, 
                         colour = "reef",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("Offshore", "Inshore"), values = c("turquoise", "brown"))+
  scale_fill_manual("", labels = c("Offshore", "Inshore"), values = c("turquoise", "brown"))+
  ggtitle("PAST by reef environment")


por.pca.plot <- plot_grid(por.pco2.PCA, por.temp.PCA, por.reef.PCA, ncol=3)
por.pca.plot


######## UTEN only
t.df <- subset(pca.df, species=="T")
ten.pca.out <- prcomp(t.df[, c(14:19)], scale. = TRUE, center = TRUE)

ten.pco2.PCA <- autoplot(ten.pca.out, data = t.df, 
                         colour = "fpco2",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("280 uatm", "400 uatm", "700 uatm", "2800 uatm"), values = c("#2c7bb6", "#abd9e9", "#fdae61", "#d7191c"))+
  scale_fill_manual("", labels = c("280 uatm", "400 uatm", "700 uatm", "2800 uatm"), values = c("#2c7bb6", "#abd9e9", "#fdae61", "#d7191c"))+
  ggtitle("UTEN by pCO2")


ten.temp.PCA <- autoplot(ten.pca.out, data = t.df, 
                         colour = "ftemp",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("28C", "31C"), values = c("blue", "red"))+
  scale_fill_manual("", labels = c("28C", "31C"), values = c("blue", "red"))+
  ggtitle("UTEN by temperature")


ten.reef.PCA <- autoplot(ten.pca.out, data = t.df, 
                         colour = "reef",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("Offshore", "Inshore"), values = c("turquoise", "brown"))+
  scale_fill_manual("", labels = c("Offshore", "Inshore"), values = c("turquoise", "brown"))+
  ggtitle("UTEN by reef environment")


ten.pca.plot <- plot_grid(ten.pco2.PCA, ten.temp.PCA, ten.reef.PCA, ncol=3)
ten.pca.plot
```



# Comparison between physiological parameters per fragment
<font color='darkmagenta'>Linear Regression between carbohydrate and protein</font>  
<div style= "float:left;position:">
```{r, echo=FALSE, fig.height = 4.5, fig.width = 4.5, fig.align = "center"}
df$sum_bw5 <- df$sum_bw5 * -1
df.90b <- df[,c(1:17, 37:38)]

df.90b.S <- subset(df.90b, species=="S")
df.90b.P <- subset(df.90b, species=="P")
df.90b.A <- subset(df.90b, species=="A")
df.90b.T <- subset(df.90b, species=="T")

carb.pro.lm <- summary(lm(pro ~ carb, data=df.90b))
carb.pro.R2 <- carb.pro.lm$adj.r.squared

Scarb.pro.lm <- summary(lm(pro ~ carb, data=df.90b.S))
Scarb.pro.R2 <- Scarb.pro.lm$adj.r.squared

Pcarb.pro.lm <- summary(lm(pro ~ carb, data=df.90b.P))
Pcarb.pro.R2 <- Pcarb.pro.lm$adj.r.squared

Acarb.pro.lm <- summary(lm(pro ~ carb, data=df.90b.A))
Acarb.pro.R2 <- Acarb.pro.lm$adj.r.squared

Tcarb.pro.lm <- summary(lm(pro ~ carb, data=df.90b.T))
Tcarb.pro.R2 <- Tcarb.pro.lm$adj.r.squared

ggplot(df.90b, aes(x = pro, y = carb, colour = treat, group = species))+
  geom_point()+
  theme(plot.title = element_text(hjust = 0.5, size = 10), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.position = "none")+
  geom_smooth(method="lm", colour="darkgrey", se=FALSE)+
  facet_wrap(~species, scales = "free", ncol=2, labeller = as_labeller(c("S" = "SSID", "P" = "PSTR", "A" = "PAST", "T" = "UTEN")))+
  xlab(calab)+
  ylab(plab)+
  ggtitle(bquote(bold(atop("Rs"^2 == .(Scarb.pro.R2)~ ";  Rp"^2 == .(Pcarb.pro.R2),
                           ~" Ra"^2 == .(Acarb.pro.R2)~ ";  Rt"^2 == .(Tcarb.pro.R2)))))
```
</div>
***
```{r, echo=FALSE}
carb.pro.lm
```
***
<font color='darkmagenta'>Linear Regression between chlorophyll and symbiont density</font>  
<div style= "float:left;position:">
```{r, echo=FALSE, fig.height = 4.5, fig.width = 4.5, fig.align = "center"}
den.chla.lm <- summary(lm(chla ~ den, data=df.90b))
den.chla.R2 <- den.chla.lm$adj.r.squared

Sden.chla.lm <- summary(lm(chla ~ den, data=df.90b.S))
Sden.chla.R2 <- Sden.chla.lm$adj.r.squared

Pden.chla.lm <- summary(lm(chla ~ den, data=df.90b.P))
Pden.chla.R2 <- Pden.chla.lm$adj.r.squared

Aden.chla.lm <- summary(lm(chla ~ den, data=df.90b.A))
Aden.chla.R2 <- Aden.chla.lm$adj.r.squared

Tden.chla.lm <- summary(lm(chla ~ den, data=df.90b.T))
Tden.chla.R2 <- Tden.chla.lm$adj.r.squared

ggplot(df.90b, aes(x = chla, y = den, colour = treat, group = species))+
  geom_point()+
  theme(plot.title = element_text(hjust = 0.5, size = 10), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.position = "none")+
  geom_smooth(method="lm", colour="darkgrey", se=FALSE)+
  facet_wrap(~species, ncol=2, scales = "free", labeller = as_labeller(c("S" = "SSID", "P" = "PSTR", "A" = "PAST", "T" = "UTEN")))+
  xlab(clab)+
  ylab(dlab)+
  ggtitle(bquote(bold(atop("Rs"^2 == .(Sden.chla.R2)~ ";  Rp"^2 == .(Pden.chla.R2),
                           ~"Ra"^2 == .(Aden.chla.R2)~ ";  Rt"^2 == .(Tden.chla.R2)))))
```
</div>
***
```{r, echo=FALSE}
den.chla.lm
```
***

<font color='darkmagenta'>Linear Regression between colour intensity and symbiont density</font>  
<div style= "float:left;position:">
```{r, echo=FALSE, fig.height = 4.5, fig.width = 4.5, fig.align = "center"}
den.sum_bw5.lm <- summary(lm(sum_bw5 ~ den, data=df.90b))
den.sum_bw5.R2 <- den.sum_bw5.lm$adj.r.squared

Sden.sum_bw5.lm <- summary(lm(sum_bw5 ~ den, data=df.90b.S))
Sden.sum_bw5.R2 <- Sden.sum_bw5.lm$adj.r.squared

Pden.sum_bw5.lm <- summary(lm(sum_bw5 ~ den, data=df.90b.P))
Pden.sum_bw5.R2 <- Pden.sum_bw5.lm$adj.r.squared

Aden.sum_bw5.lm <- summary(lm(sum_bw5 ~ den, data=df.90b.A))
Aden.sum_bw5.R2 <- Aden.sum_bw5.lm$adj.r.squared

Tden.sum_bw5.lm <- summary(lm(sum_bw5 ~ den, data=df.90b.T))
Tden.sum_bw5.R2 <- Tden.sum_bw5.lm$adj.r.squared

ggplot(df.90b, aes(x = sum_bw5, y = den, colour = treat, group = species))+
  geom_point()+
  theme(plot.title = element_text(hjust = 0.5, size = 10), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.position = "none")+
  geom_smooth(method="lm", colour="darkgrey", se=FALSE)+
  facet_wrap(~species, ncol=2, scales = "free", labeller = as_labeller(c("S" = "SSID", "P" = "PSTR", "A" = "PAST", "T" = "UTEN")))+
  xlab("colour intensity")+
  ylab(dlab)+
  ggtitle(bquote(bold(atop("Rs"^2 == .(Sden.sum_bw5.R2)~ ";  Rp"^2 == .(Pden.sum_bw5.R2),
                           ~"Ra"^2 == .(Aden.sum_bw5.R2)~ ";  Rt"^2 == .(Tden.sum_bw5.R2)))))
```
</div>
***
```{r, echo=FALSE}
den.sum_bw5.lm
```
***

<font color='darkmagenta'>Linear Regression between colour intensity and chlorophyll</font>  
<div style= "float:left;position:">
```{r, echo=FALSE, fig.height = 4.5, fig.width = 4.5, fig.align = "center"}
chla.sum_bw5.lm <- summary(lm(sum_bw5 ~ chla, data=df.90b))
chla.sum_bw5.R2 <- chla.sum_bw5.lm$adj.r.squared

Schla.sum_bw5.lm <- summary(lm(sum_bw5 ~ chla, data=df.90b.S))
Schla.sum_bw5.R2 <- Schla.sum_bw5.lm$adj.r.squared

Pchla.sum_bw5.lm <- summary(lm(sum_bw5 ~ chla, data=df.90b.P))
Pchla.sum_bw5.R2 <- Pchla.sum_bw5.lm$adj.r.squared

Achla.sum_bw5.lm <- summary(lm(sum_bw5 ~ chla, data=df.90b.A))
Achla.sum_bw5.R2 <- Achla.sum_bw5.lm$adj.r.squared

Tchla.sum_bw5.lm <- summary(lm(sum_bw5 ~ chla, data=df.90b.T))
Tchla.sum_bw5.R2 <- Tchla.sum_bw5.lm$adj.r.squared

ggplot(df.90b, aes(x = sum_bw5, y = chla, colour = treat, group = species))+
  geom_point()+
  theme(plot.title = element_text(hjust = 0.5, size = 10), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.position = "none")+
  geom_smooth(method="lm", colour="darkgrey", se=FALSE)+
  facet_wrap(~species, ncol=2, scales = "free", labeller = as_labeller(c("S" = "SSID", "P" = "PSTR", "A" = "PAST", "T" = "UTEN")))+
  xlab("colour intensity")+
  ylab(clab)+
  ggtitle(bquote(bold(atop("Rs"^2 == .(Schla.sum_bw5.R2)~ ";  Rp"^2 == .(Pchla.sum_bw5.R2),
                           ~"Ra"^2 == .(Achla.sum_bw5.R2)~ ";  Rt"^2 == .(Tchla.sum_bw5.R2)))))
```
</div>
***  
```{r, echo=FALSE}
chla.sum_bw5.lm
```
***
  
<font color='darkmagenta'>Linear Regression between protein and chlorophyll</font>  
<div style= "float:left;position:">
```{r, echo=FALSE, fig.height = 4.5, fig.width = 4.5, fig.align = "center"}
df.90b.S <- subset(df.90b, species=="S")
df.90b.P <- subset(df.90b, species=="P")
df.90b.A <- subset(df.90b, species=="A")
df.90b.T <- subset(df.90b, species=="T")

chla.pro.lm <- summary(lm(pro ~ chla, data=df.90b))
chla.pro.R2 <- chla.pro.lm$adj.r.squared

Schla.pro.lm <- summary(lm(pro ~ chla, data=df.90b.S))
Schla.pro.R2 <- Schla.pro.lm$adj.r.squared

Pchla.pro.lm <- summary(lm(pro ~ chla, data=df.90b.P))
Pchla.pro.R2 <- Pchla.pro.lm$adj.r.squared

Achla.pro.lm <- summary(lm(pro ~ chla, data=df.90b.A))
Achla.pro.R2 <- Achla.pro.lm$adj.r.squared

Tchla.pro.lm <- summary(lm(pro ~ chla, data=df.90b.T))
Tchla.pro.R2 <- Tchla.pro.lm$adj.r.squared

ggplot(df.90b, aes(x = pro, y = chla, colour = treat, group = species))+
  geom_point()+
  theme(plot.title = element_text(hjust = 0.5, size = 10), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.position = "none")+
  geom_smooth(method="lm", colour="darkgrey", se=FALSE)+
  facet_wrap(~species, ncol=2, scales = "free", labeller = as_labeller(c("S" = "SSID", "P" = "PSTR", "A" = "PAST", "T" = "UTEN")))+
  xlab(plab)+
  ylab(clab)+
  ggtitle(bquote(bold(atop("Rs"^2 == .(Schla.pro.R2)~ ";  Rp"^2 == .(Pchla.pro.R2),
                           ~"Ra"^2 == .(Achla.pro.R2)~ ";  Rt"^2 == .(Tchla.pro.R2)))))
```
</div>
***  
```{r, echo=FALSE}
    chla.pro.lm
```
***
  
<font color='darkmagenta'>Linear Regression between carbohydrate and chlorophyll</font>  
<div style= "float:left;position:">
```{r, echo=FALSE, fig.height = 4.5, fig.width = 4.5, fig.align = "center"}
df.90b.S <- subset(df.90b, species=="S")
df.90b.P <- subset(df.90b, species=="P")
df.90b.A <- subset(df.90b, species=="A")
df.90b.T <- subset(df.90b, species=="T")

chla.carb.lm <- summary(lm(carb ~ chla, data=df.90b))
chla.carb.R2 <- chla.carb.lm$adj.r.squared

Schla.carb.lm <- summary(lm(carb ~ chla, data=df.90b.S))
Schla.carb.R2 <- Schla.carb.lm$adj.r.squared

Pchla.carb.lm <- summary(lm(carb ~ chla, data=df.90b.P))
Pchla.carb.R2 <- Pchla.carb.lm$adj.r.squared

Achla.carb.lm <- summary(lm(carb ~ chla, data=df.90b.A))
Achla.carb.R2 <- Achla.carb.lm$adj.r.squared

Tchla.carb.lm <- summary(lm(carb ~ chla, data=df.90b.T))
Tchla.carb.R2 <- Tchla.carb.lm$adj.r.squared

ggplot(df.90b, aes(x = carb, y = chla, colour = treat, group = species))+
  geom_point()+
  theme(plot.title = element_text(hjust = 0.5, size = 10), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.position = "none")+
  geom_smooth(method="lm", colour="darkgrey", se=FALSE)+
  facet_wrap(~species, ncol=2, scales = "free", labeller = as_labeller(c("S" = "SSID", "P" = "PSTR", "A" = "PAST", "T" = "UTEN")))+
  xlab(calab)+
  ylab(clab)+
  ggtitle(bquote(bold(atop("Rs"^2 == .(Schla.carb.R2)~ ";  Rp"^2 == .(Pchla.carb.R2),
                           ~"Ra"^2 == .(Achla.carb.R2)~ ";  Rt"^2 == .(Tchla.carb.R2)))))
```
</div>
***  
```{r, echo=FALSE}
chla.carb.lm
```
***

<font color='darkmagenta'>Linear Regression between protein and calcification rate</font>  
<div style= "float:left;position:">
```{r, echo=FALSE, fig.height = 4.5, fig.width = 4.5, fig.align = "center"}
rate.pro.lm <- summary(lm(pro ~ rate, data=df.90b))
rate.pro.R2 <- rate.pro.lm$adj.r.squared

Srate.pro.lm <- summary(lm(pro ~ rate, data=df.90b.S))
Srate.pro.R2 <- Srate.pro.lm$adj.r.squared

Prate.pro.lm <- summary(lm(pro ~ rate, data=df.90b.P))
Prate.pro.R2 <- Prate.pro.lm$adj.r.squared

Arate.pro.lm <- summary(lm(pro ~ rate, data=df.90b.A))
Arate.pro.R2 <- Arate.pro.lm$adj.r.squared

Trate.pro.lm <- summary(lm(pro ~ rate, data=df.90b.T))
Trate.pro.R2 <- Trate.pro.lm$adj.r.squared

ggplot(df.90b, aes(x = pro, y = rate, colour = treat, group = species))+
  geom_point()+
  theme(plot.title = element_text(hjust = 0.5, size = 10), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.position = "none")+
  geom_smooth(method="lm", colour="darkgrey", se=FALSE)+
  facet_wrap(~species, ncol=2, scales = "free", labeller = as_labeller(c("S" = "SSID", "P" = "PSTR", "A" = "PAST", "T" = "UTEN")))+
  xlab(plab)+
  ylab(rlab)+
  ggtitle(bquote(bold(atop("Rs"^2 == .(Srate.pro.R2)~ ";  Rp"^2 == .(Prate.pro.R2),
                           ~"Ra"^2 == .(Arate.pro.R2)~ ";  Rt"^2 == .(Trate.pro.R2)))))
```
</div>
***
```{r, echo=FALSE}
rate.pro.lm
```
***
 
<font color='darkmagenta'>Linear Regression between carbohydrate and calcification rate</font>  
<div style= "float:left;position:">
```{r, echo=FALSE, fig.height = 4.5, fig.width = 4.5, fig.align = "center"}
rate.carb.lm <- summary(lm(carb ~ rate, data=df.90b))
rate.carb.R2 <- rate.carb.lm$adj.r.squared

Srate.carb.lm <- summary(lm(carb ~ rate, data=df.90b.S))
Srate.carb.R2 <- Srate.carb.lm$adj.r.squared

Prate.carb.lm <- summary(lm(carb ~ rate, data=df.90b.P))
Prate.carb.R2 <- Prate.carb.lm$adj.r.squared

Arate.carb.lm <- summary(lm(carb ~ rate, data=df.90b.A))
Arate.carb.R2 <- Arate.carb.lm$adj.r.squared

Trate.carb.lm <- summary(lm(carb ~ rate, data=df.90b.T))
Trate.carb.R2 <- Trate.carb.lm$adj.r.squared

ggplot(df.90b, aes(x = carb, y = rate, colour = treat, group = species))+
 geom_point()+
 theme(plot.title = element_text(hjust = 0.5, size = 10), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.position = "none")+
  geom_smooth(method="lm", colour="darkgrey", se=FALSE)+
  facet_wrap(~species, ncol=2, scales = "free", labeller = as_labeller(c("S" = "SSID", "P" = "PSTR", "A" = "PAST", "T" = "UTEN")))+
  xlab(calab)+
  ylab(rlab)+
  ggtitle(bquote(bold(atop("Rs"^2 == .(Srate.carb.R2)~ ";  Rp"^2 == .(Prate.carb.R2),
                           ~"Ra"^2 == .(Arate.carb.R2)~ ";  Rt"^2 == .(Trate.carb.R2)))))
```
</div>
***
```{r, echo=FALSE}
rate.carb.lm
```    

***
  
<font color='darkmagenta'>Linear Regression between chlorophyll and calcification rate</font>  
<div style= "float:left;position:">
```{r, echo=FALSE, fig.height = 4.5, fig.width = 4.5, fig.align = "center"}
rate.chla.lm <- summary(lm(chla ~ rate, data=df.90b))
rate.chla.R2 <- rate.chla.lm$adj.r.squared

Srate.chla.lm <- summary(lm(chla ~ rate, data=df.90b.S))
Srate.chla.R2 <- Srate.chla.lm$adj.r.squared

Prate.chla.lm <- summary(lm(chla ~ rate, data=df.90b.P))
Prate.chla.R2 <- Prate.chla.lm$adj.r.squared

Arate.chla.lm <- summary(lm(chla ~ rate, data=df.90b.A))
Arate.chla.R2 <- Arate.chla.lm$adj.r.squared

Trate.chla.lm <- summary(lm(chla ~ rate, data=df.90b.T))
Trate.chla.R2 <- Trate.chla.lm$adj.r.squared

ggplot(df.90b, aes(x = chla, y = rate, colour = treat, group = species))+
  geom_point()+
  theme(plot.title = element_text(hjust = 0.5, size = 10), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.position = "none")+
  geom_smooth(method="lm", colour="darkgrey", se=FALSE)+
  facet_wrap(~species, ncol=2, scales = "free", labeller = as_labeller(c("S" = "SSID", "P" = "PSTR", "A" = "PAST", "T" = "UTEN")))+
  xlab(clab)+
  ylab(rlab)+
  ggtitle(bquote(bold(atop("Rs"^2 == .(Srate.chla.R2)~ ";  Rp"^2 == .(Prate.chla.R2),
                           ~"Ra"^2 == .(Arate.chla.R2)~ ";  Rt"^2 == .(Trate.chla.R2)))))
```
</div>
***
```{r, echo=FALSE}
rate.chla.lm
```  

***

<font color='darkmagenta'>Linear Regression between symbiont density and calcification rate</font>  
<div style= "float:left;position:">
```{r, echo=FALSE, fig.height = 4.5, fig.width = 4.5, fig.align = "center"}
rate.den.lm <- summary(lm(den ~ rate, data=df.90b))
rate.den.R2 <- rate.den.lm$adj.r.squared

Srate.den.lm <- summary(lm(den ~ rate, data=df.90b.S))
Srate.den.R2 <- Srate.den.lm$adj.r.squared

Prate.den.lm <- summary(lm(den ~ rate, data=df.90b.P))
Prate.den.R2 <- Prate.den.lm$adj.r.squared

Arate.den.lm <- summary(lm(den ~ rate, data=df.90b.A))
Arate.den.R2 <- Arate.den.lm$adj.r.squared

Trate.den.lm <- summary(lm(den ~ rate, data=df.90b.T))
Trate.den.R2 <- Trate.den.lm$adj.r.squared

ggplot(df.90b, aes(x = den, y = rate, colour = treat, group = species))+
  geom_point()+
  theme(plot.title = element_text(hjust = 0.5, size = 10), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.position = "none")+
  geom_smooth(method="lm", colour="darkgrey", se=FALSE)+
  facet_wrap(~species, ncol=2, scales = "free", labeller = as_labeller(c("S" = "SSID", "P" = "PSTR", "A" = "PAST", "T" = "UTEN")))+
  xlab(dlab)+
  ylab(rlab)+
  ggtitle(bquote(bold(atop("Rs"^2 == .(Srate.den.R2)~ ";  Rp"^2 == .(Prate.den.R2),
                           ~"Ra"^2 == .(Arate.den.R2)~ ";  Rt"^2 == .(Trate.den.R2)))))
```
</div>
***
```{r, echo=FALSE}
rate.den.lm
```    