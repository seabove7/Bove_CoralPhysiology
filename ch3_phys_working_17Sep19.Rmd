---
title: "Chapter 3: Physiology results"
author: "CBB"
output: 
  html_document:
    theme: cerulean
editor_options: 
  chunk_output_type: console
---
<br/>
<br/>
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(warn = -1)
library("knitr")
```

```{r packages, include=FALSE}
#Packages to load
library("readr")
library("ggplot2")
library("dplyr")
library("tidyr")
library("tidyverse")
library("Rmisc")
library("cowplot")
library("ggfortify")
library("kableExtra")
library("readr")
library("lme4")
library("magick")
```

```{r setup2, include=FALSE}
#Set some standards and units
#dodge width
dodge=position_dodge(width=0.3)
dodge2=position_dodge(width = 0.6)
jitter=position_jitter(width=0.1)

theme_set(theme_classic())

# set parameter labels
Tlab<-"Temperature (Â°C)"
alab<-expression(paste(italic("p"),"CO" [2]~ "("*mu,'atm)'))
dlab<-expression(paste("Symbiont density (10"^6,"cells cm"^-2,")"))
plab<-expression(paste("Total protein (mg cm"^-2,")"))
calab<-expression(paste("Carbohydrate (mg cm"^-2,")"))
clab<-expression(paste("Chlorophyll a ("*mu,"g cm"^-2,")"))
rlab<-expression(paste("Calcification rate (mg cm"^-2~"day"^-1,")"))
date <- Sys.Date() 
```

```{r initial dataframe, include=FALSE}
# Set up the dataframes
#phys <- read_csv("/Users/colleen/Dropbox/Boston_Experiment/Physiology/phys_R_code/16Jul16 Update/phys_all_25Jul19.csv")
#
#carb <- read_csv("~/Dropbox/Boston_Experiment/Physiology/Carbohydrate/Calculated_Carbs/Carb_final_10Aug19.csv")
#carb <- carb[,c(2,22)]
#
#df<-phys %>% 
#  left_join(carb, by=c("coral" = "coral"))

#write.csv(df, file="phys_all_13Aug19.csv")  
df <- read_csv("phys_all_13Aug19.csv")

df$X1 <- NULL
names(df)[38]<-"carb"
df$ftemp <- as.factor(df$ftemp)
df$fpco2 <- as.factor(df$fpco2)
df$colony <- as.factor(df$colony)
df$species <- factor(df$species, levels = c("S", "P", "A", "T"))
df$fpco2 <- factor(df$fpco2, c("280", "400", "700", "2800"))
df$den <- df$den / 1000000
df$treat[df$T0_T90 == "T0"] <- "T0"
df$treat <- factor(df$treat, c("T0", "288_28", "311_31", "447_28", "405_31", "673_28", "701_31", "3285_28", "3309_31"))
```

# **Part 1:** *T0 versus T90 physiology* 

### Figure 1

```{r, echo=FALSE, fig.height = 4, fig.width = 8, fig.align = "center", results = 'hide'}
T0.df <- subset(df, T0_T90=="T0") # dataframe of T0 only
T0.df <- T0.df[,c(1:16,38)]


T0.df <- gather(T0.df, param, value, den:carb) # make column of parameter and value
T0.df$param <- factor(T0.df$param, levels = c("pro", "carb", "den", "chla"))

T0.sum <- summarySE(data = T0.df, measurevar = "value", groupvars = c("param", "species"), na.rm = T)

T0.fig <- ggplot()+
  theme(panel.grid.major=element_blank(), legend.position="none", panel.grid.minor=element_blank(), panel.background=element_blank(),legend.key=element_blank(),strip.background = element_blank(), strip.placement = "outside", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  scale_x_discrete(labels = c(S = "SSID", P = "PSTR", A = "PAST", T = "UTEN"))+
  xlab("")+
  ylab("")+
  ggtitle("A")+
  geom_point(data=T0.df, aes(x=species, y=value, colour=col, shape = reef),size = 2.5, position=dodge)+
  geom_linerange(data=T0.sum, aes(x = species, ymin = value - se, ymax = value + se))+
  geom_point(data=T0.sum, aes(x=species, y=value), shape=95, colour="black", size = 7)+
  facet_wrap(~param, scales = "free_y",strip.position = "left", labeller = as_labeller( c(chla = "Chlorophyll \n (ug/cm2)", den = "Symbiont Density \n (10^6 cells cm2)", pro = "Total Protein \n (mg/cm2)", carb = "Carbohydrate \n (mg/cm2)")))
T0.fig

T0.sum2 <- summarySE(data = T0.df, measurevar = "value", groupvars = c("param", "species", "reef"), na.rm = T)

T0.fig2 <- ggplot()+
  theme(panel.grid.major=element_blank(), legend.position="bottom", panel.grid.minor=element_blank(), panel.background=element_blank(),legend.key=element_blank(),strip.background = element_blank(), strip.placement = "outside", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  scale_x_discrete(labels = c(S = "SSID", P = "PSTR", A = "PAST", T = "UTEN"))+
  xlab("Species")+
  ylab("")+
  ggtitle("B")+
  geom_point(data=T0.df, aes(x=species, y=value, colour=reef),size = 2.5, position=dodge, alpha = 0.5)+
  geom_linerange(data=T0.sum2, aes(x = species, ymin = value - se, ymax = value + se, colour = reef), position = dodge2)+
  geom_point(data=T0.sum2, aes(x=species, y=value, colour=reef), shape=95, size = 7, position = dodge2)+
  scale_color_manual("Reef Environment", values = c("darkgrey", "black"))+
  facet_wrap(~param, scales = "free_y",strip.position = "left", labeller = as_labeller( c(chla = "Chlorophyll \n (ug/cm2)", den = "Symbiont Density \n (10^6 cells cm2)", pro = "Total Protein \n (mg/cm2)", carb = "Carbohydrate \n (mg/cm2)")))
T0.fig2


#fig <- paste("T0.fig", date, sep="_") 
#fig <- paste(fig, ".pdf", sep="") 
#
#pdf(fig, width = 7, height = 3)
#T0.fig
#dev.set(dev.next())
```
**Figure 1.** True mean (+/- SE) physiology of T0 coral fragments (one per colony; n = 8-14) denoted by black cross with (A) individual colony physiology denoted by coloured shape or (B) native reef environment.
<br/>
<br/>

### Figure 2
```{r, echo=FALSE, fig.height = 16, fig.width = 10, fig.align = "center", results = 'hide'}
df2 <- df[,c(1:16,38)]
df.comp <- gather(df2, param, value, den:carb) # make column of parameter and value
df.comp$param <- factor(df.comp$param, levels = c("pro", "carb", "den", "chla"))


# make a 'treat' column for better spacing of plot
df.comp$treat2 <- df.comp$treat
df.comp$treat <- gsub("T0", 2, df.comp$treat)
df.comp$treat <- gsub("288_28", 4, df.comp$treat)
df.comp$treat <- gsub("311_31", 4.5, df.comp$treat)
df.comp$treat <- gsub("447_28", 6, df.comp$treat)
df.comp$treat <- gsub("405_31", 6.5, df.comp$treat)
df.comp$treat <- gsub("673_28", 8, df.comp$treat)
df.comp$treat <- gsub("701_31", 8.5, df.comp$treat)
df.comp$treat <- gsub("3285_28", 10, df.comp$treat)
df.comp$treat <- gsub("3309_31", 10.5, df.comp$treat)

df.comp$treat <- as.numeric(df.comp$treat)


comp.sum <- summarySE(data = df.comp, measurevar = "value", groupvars = c("param", "species", "treat", "T0_T90", "treat2"), na.rm = TRUE)

comp.fig <-ggplot(comp.sum, aes(colour=treat2, shape = treat2))+
  theme(legend.position="bottom", panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.placement = "outside", panel.border = element_rect(colour = "black", fill=NA, size=1), axis.text.x = element_text(angle=45))+
  scale_x_discrete(breaks=c(2, 4, 6, 8, 10))+
  ylab("")+
  geom_vline(xintercept = 3)+
  geom_point(data=df.comp, aes(treat, value), position = dodge2, alpha=0.3, size=1)+
  geom_linerange(aes(x = treat, ymin=value-se, ymax=value+se, colour=treat2), position=dodge2)+
  geom_point(aes(treat, value), position = dodge2, size=2)+
  scale_colour_manual("Treatment", labels=c("T0", "280_28", "280_31", "400_28", "400_31", "700_28", "700_31", "2800_28", "2800_31"), values = c("#009E73", "#0072B2", "#D55E00", "#0072B2", "#D55E00", "#0072B2", "#D55E00", "#0072B2", "#D55E00"))+
  scale_shape_manual("Treatment", labels=c("T0", "280_28", "280_31", "400_28", "400_31", "700_28", "700_31", "2800_28", "2800_31"), values = c(8, 18, 18, 15, 15, 16, 16, 17, 17))+
  facet_wrap(param~species, scales = "free", strip.position = "top", labeller = as_labeller( c(chla = "Chlorophyll \n (ug/cm2)", den = "Symbiont Density \n (10^6 cells cm2)", pro = "Total Protein \n (mg/cm2)", carb = "Carbohydrate \n (mg/cm2)", S = "SSID", P = "PSTR", A = "PAST", T = "UTEN")))


# make cowplot of all coral images
s <- cowplot::ggdraw() + cowplot::draw_image("SSID.png", scale = 0.9) 
p <- cowplot::ggdraw() + cowplot::draw_image("PSTR.png", scale = 0.9)
a <- cowplot::ggdraw() + cowplot::draw_image("PAST.png", scale = 0.9)
u <- cowplot::ggdraw() + cowplot::draw_image("UTEN.png", scale = 0.9)
corals <- cowplot::plot_grid(s, p, a, u, labels = c("a", "b", "c", "d"), ncol = 4)

# full T0 plot with coral images
full.T0.fig <- plot_grid(corals, comp.fig, ncol = 1, align = "v", axis = 'lb', rel_heights = c(3,12))
full.T0.fig


#
#fig2 <- paste("T0_T90_fig", date, sep="_") 
#fig2 <- paste(fig2, ".pdf", sep="") 
#
#pdf(fig2, width = 7, height = 7)
#comp.fig
#dev.set(dev.next())
```
**Figure 2.** True mean (+/- SE) T0 and T90 coral fragment physiology of *(a) S. siderea*, *(b) P. strigosa*, *(c) P. astreoides*, and *(d) U. tenuifolia* with individual coral fragment physiology denoted by points. T0 corals are represented by green stars. Blue denotes 28C, red denotes 31C, and shape corresponds to *p*CO2 treatment conditions of T90 fragments.
<br/>
<br/>


# **Part 2:** *Effects of treatment on T90 physiology* 
<br/>
```{r protein model, echo=FALSE, fig.height = 2, fig.width = 10, fig.align = "center", results = 'hide', message=FALSE}
#modify dataframe
T90.df <- df[,c(1:18,38)]
T90.df <- subset(T90.df, T0_T90=="T90")
T90.df$sum_bw5 <- T90.df$sum_bw5  * -1
T90.df <- gather(T90.df, param, value, den:carb) # make column of parameter and value
T90.df$param <- factor(T90.df$param, levels = c("pro", "carb", "den", "chla", "sum_bw5"))
T90.df$fpco2 <- factor(T90.df$fpco2, c("280", "400", "700", "2800"))
T90.df$species <- revalue(x = T90.df$species, c("S" = "SSID", "P" = "PSTR", 
  "A" = "PAST", "T" = "UTEN"))


T90.df.pro <- subset(T90.df, param=="pro")


# this function remove rows with any missing values
completeFun <- function(data, desiredCols) {
  completeVec <- complete.cases(data[, desiredCols])
  return(data[completeVec, ])
}
T90.df.pro <- completeFun(T90.df.pro, "value") # run function to remove any missing values from "rate"

# mixed effect model run using lmer()
T90.pro.model <- lmer(value ~ species * (fpco2 + ftemp) + (1 | colony), REML=T, data = T90.df.pro)


### Performing the parametric bootstrapping of the model:
bootnum = 1500 # set number of iterations (we used 1500) between 999 and 9999
seed = 4 #seed to make results replicatable (our seed was 4)

#out <- simulate(T90.pro.model,nsim=bootnum,seed=seed,re.form=NULL)
#boots <- apply(out,2,function(x) predict(lmer(x ~ species * (fpco2 + ftemp) + (1 | colony), REML=T, #data = T90.df.pro),re.form=NA))
#
#boots <- cbind(predict(T90.pro.model,re.form=NA), boots)
#T90.df.pro.a <- (cbind(T90.df.pro, as.data.frame(t(apply(boots, 1, function(x) c(mean(x), #quantile(x, c(0.025, 0.975))))))))
#colnames(T90.df.pro.a)[16:18] <- c("mean", "lowerci", "upperci")
#
#
#pro.df <- paste("Protein_model_T90", date, sep="_") 
#pro.df <- paste(pro.df, ".csv", sep="") 
#write.csv(T90.df.pro.a, file=pro.df)  

T90.df.pro.a <- read.csv("Protein_model_T90_2019-09-19.csv", head=T)
T90.df.pro.a$ftemp <- as.factor(T90.df.pro.a$ftemp)
T90.df.pro.a$fpco2 <- as.factor(T90.df.pro.a$fpco2)
T90.df.pro.a$species <- factor(T90.df.pro.a$species, levels = c("SSID", "PSTR", "PAST", "UTEN"))

pro.model.fig <- ggplot(T90.df.pro.a)+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(),
  strip.text.x = element_blank(), legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  ylab("Total Protein")+
  xlab("")+
  geom_point(aes(fpco2, value, colour=ftemp), position = dodge2, alpha = 0.3, shape = 17)+
  geom_linerange(aes(x=fpco2, ymin=lowerci, ymax=upperci, colour=ftemp), position = dodge, size = 1)+
  scale_color_manual("Temperature", values = c("blue", "red"))+
  facet_wrap(~species, ncol=4)
```

```{r carb model, echo=FALSE, fig.height = 2, fig.width = 10, fig.align = "center", results = 'hide', message=FALSE}
T90.df.carb <- subset(T90.df, param=="carb")
#T90.df.carb <- subset(T90.df.carb2, species != "UTEN")

# this function remove rows with any missing values
completeFun <- function(data, desiredCols) {
  completeVec <- complete.cases(data[, desiredCols])
  return(data[completeVec, ])
}
T90.df.carb <- completeFun(T90.df.carb, "value") # run function to remove any missing values from "rate"

# mixed effect model run using lmer()
T90.carb.model <- lmer(value ~ species + fpco2 + ftemp + (1 | colony), REML=T, data = T90.df.carb)

## Performing the parametric bootstrapping of the model:
#out <- simulate(T90.carb.model,nsim=bootnum,seed=seed,re.form=NULL) 
#boots <- apply(out,2,function(x) predict(lmer(x ~ species + fpco2 + ftemp + (1 | colony), REML=T, #data = T90.df.carb),re.form=NA)) 
#
#boots <- cbind(predict(T90.carb.model,re.form=NA), boots) 
#T90.df.carb.a <- (cbind(T90.df.carb, as.data.frame(t(apply(boots, 1, function(x) c(mean(x), #quantile(x, c(0.025, 0.975)))))))) 
#colnames(T90.df.carb.a)[16:18] <- c("mean", "lowerci", "upperci") 
#
#carb.df <- paste("Carbohydrate_model_T90", date, sep="_") 
#carb.df <- paste(carb.df, ".csv", sep="") 
#write.csv(T90.df.carb.a, file=carb.df)  

T90.df.carb.a <- read.csv("Carbohydrate_model_T90_2019-09-19.csv", head=T)
T90.df.carb.a$ftemp <- as.factor(T90.df.carb.a$ftemp)
T90.df.carb.a$fpco2 <- as.factor(T90.df.carb.a$fpco2)
T90.df.carb.a$species <- factor(T90.df.carb.a$species, levels = c("SSID", "PSTR", "PAST", "UTEN"))

carb.model.fig <- ggplot(T90.df.carb.a)+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(),  strip.background = element_blank(),
  strip.text.x = element_blank(), legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  facet_wrap(~species, ncol=4)+
  ylab("Carbohydrate")+
  xlab("")+
  geom_point(aes(fpco2, value, colour=ftemp), position = dodge2, alpha = 0.3, shape = 17)+
  geom_linerange(aes(x=fpco2, ymin=lowerci, ymax=upperci, colour=ftemp), position = dodge, size = 1)+
  scale_color_manual("Temperature", values = c("blue", "red"))

```

```{r denisty model, echo=FALSE, fig.height = 2, fig.width = 10, fig.align = "center", results = 'hide', message=FALSE}
T90.df.den <- subset(T90.df, param=="den")
#T90.df.den <- subset(T90.df.den2, species != "UTEN")

# this function remove rows with any missing values
completeFun <- function(data, desiredCols) {
  completeVec <- complete.cases(data[, desiredCols])
  return(data[completeVec, ])
}
T90.df.den <- completeFun(T90.df.den, "value") # run function to remove any missing values from "rate"

# mixed effect model run using lmer()
T90.den.model <- lmer(value ~ species + fpco2 + ftemp + (1 | colony), REML=T, data = T90.df.den)

## Performing the parametric bootstrapping of the model:
#out <- simulate(T90.den.model,nsim=bootnum,seed=seed,re.form=NULL)
#boots <- apply(out,2,function(x) predict(lmer(x ~ species + fpco2 + ftemp + (1 | colony), REML=T, #data = T90.df.den),re.form=NA))
#
#boots <- cbind(predict(T90.den.model,re.form=NA), boots)
#T90.df.den.a <- (cbind(T90.df.den, as.data.frame(t(apply(boots, 1, function(x) c(mean(x), #quantile(x, c(0.025, 0.975))))))))
#colnames(T90.df.den.a)[16:18] <- c("mean", "lowerci", "upperci")
#
#
#den.df <- paste("Density_model_T90", date, sep="_") 
#den.df <- paste(den.df, ".csv", sep="") 
#write.csv(T90.df.den.a, file=den.df)  

T90.df.den.a <- read.csv("Density_model_T90_2019-09-19.csv", head=T)
T90.df.den.a$ftemp <- as.factor(T90.df.den.a$ftemp)
T90.df.den.a$fpco2 <- as.factor(T90.df.den.a$fpco2)
T90.df.den.a$species <- factor(T90.df.den.a$species, levels = c("SSID", "PSTR", "PAST", "UTEN"))


den.model.fig <- ggplot(T90.df.den.a)+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(),  strip.background = element_blank(),
  strip.text.x = element_blank(), legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  ylab("Symbiont Density")+
  xlab("")+
  geom_point(aes(fpco2, value, colour=ftemp), position = dodge2, alpha = 0.3, shape = 17)+
  geom_linerange(aes(x=fpco2, ymin=lowerci, ymax=upperci, colour=ftemp), position = dodge, size = 1)+
  scale_color_manual("Temperature", values = c("blue", "red"))+
  facet_wrap(~species, ncol=4)
```

```{r chlorophyll model, echo=FALSE, fig.height = 2, fig.width = 10, fig.align = "center", results = 'hide', message=FALSE}
T90.df.chla <- subset(T90.df, param=="chla")

# this function remove rows with any missing values
completeFun <- function(data, desiredCols) {
  completeVec <- complete.cases(data[, desiredCols])
  return(data[completeVec, ])
}
T90.df.chla <- completeFun(T90.df.chla, "value") # run function to remove any missing values from "rate"

# mixed effect model run using lmer()
T90.chla.model <- lmer(value ~ species * fpco2 * ftemp + (1 | colony), REML=T, data = T90.df.chla)

## Performing the parametric bootstrapping of the model:
#out <- simulate(T90.chla.model,nsim=bootnum,seed=seed,re.form=NULL) 
#boots <- apply(out,2,function(x) predict(lmer(x ~ species * fpco2 * ftemp + (1 | colony), REML=T, #data = T90.df.chla),re.form=NA)) 
#
#boots <- cbind(predict(T90.chla.model,re.form=NA), boots) 
#T90.df.chla.a <- (cbind(T90.df.chla, as.data.frame(t(apply(boots, 1, function(x) c(mean(x), #quantile(x, c(0.025, 0.975)))))))) 
#colnames(T90.df.chla.a)[16:18] <- c("mean", "lowerci", "upperci")
#
#
#chla.df <- paste("Chlorophyll_model_T90", date, sep="_") 
#chla.df <- paste(chla.df, ".csv", sep="") 
#write.csv(T90.df.chla.a, file=chla.df)  

T90.df.chla.a <- read.csv("Chlorophyll_model_T90_2019-09-19.csv", head=T)
T90.df.chla.a$ftemp <- as.factor(T90.df.chla.a$ftemp)
T90.df.chla.a$fpco2 <- as.factor(T90.df.chla.a$fpco2)
T90.df.chla.a$species <- factor(T90.df.chla.a$species, levels = c("SSID", "PSTR", "PAST", "UTEN"))


chla.model.fig <- ggplot(T90.df.chla.a)+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(),  strip.background = element_blank(),
  strip.text.x = element_blank(), legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  ylab("Chlorophyll a")+
  xlab("")+
  geom_point(aes(fpco2, value, colour=ftemp, shape = reef), position = dodge2, alpha = 0.3, shape = 17)+
  geom_linerange(aes(x=fpco2, ymin=lowerci, ymax=upperci, colour=ftemp), position = dodge, size = 1)+
  scale_color_manual("Temperature", values = c("blue", "red"))+
  facet_wrap(~species, ncol=4)
```

```{r colour model, echo=FALSE, fig.height = 2, fig.width = 10, fig.align = "center", results = 'hide', message=FALSE}
T90.df.sum <- subset(T90.df, param=="sum_bw5")

# this function remove rows with any missing values
completeFun <- function(data, desiredCols) {
  completeVec <- complete.cases(data[, desiredCols])
  return(data[completeVec, ])
}
T90.df.sum <- completeFun(T90.df.sum, "value") # run function to remove any missing values from "rate"

# mixed effect model run using lmer()
T90.sum.model <- lmer(value ~ species * (fpco2 + ftemp) + (1 | colony), REML=T, data = T90.df.sum)

## Performing the parametric bootstrapping of the model:
#out <- simulate(T90.sum.model,nsim=bootnum,seed=seed,re.form=NULL)
#boots <- apply(out,2,function(x) predict(lmer(x ~ species * (fpco2 + ftemp) + (1 | colony), REML=T, #data = T90.df.sum),re.form=NA))
#
#boots <- cbind(predict(T90.sum.model,re.form=NA), boots)
#T90.df.sum.a <- (cbind(T90.df.sum, as.data.frame(t(apply(boots, 1, function(x) c(mean(x), #quantile(x, c(0.025, 0.975))))))))
#colnames(T90.df.sum.a)[16:18] <- c("mean", "lowerci", "upperci") 
#
#
#sum.df <- paste("Colour_model_T90", date, sep="_") 
#sum.df <- paste(sum.df, ".csv", sep="") 
#write.csv(T90.df.sum.a, file=sum.df)  

T90.df.sum.a <- read.csv("Colour_model_T90_2019-09-19.csv", head=T)
T90.df.sum.a$ftemp <- as.factor(T90.df.sum.a$ftemp)
T90.df.sum.a$fpco2 <- as.factor(T90.df.sum.a$fpco2)
T90.df.sum.a$species <- factor(T90.df.sum.a$species, levels = c("SSID", "PSTR", "PAST", "UTEN"))


sum.model.fig <- ggplot(T90.df.sum.a)+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(),  strip.background = element_blank(),
  strip.text.x = element_blank(), legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  ylab("Colour Intensity")+
  xlab(alab)+
  geom_point(aes(fpco2, value, colour=ftemp, shape = reef), position = dodge2, alpha = 0.3, shape = 17)+
  geom_linerange(aes(x=fpco2, ymin=lowerci, ymax=upperci, colour=ftemp), position = dodge, size = 1)+
  scale_color_manual("Temperature", values = c("blue", "red"))+
  facet_wrap(~species, ncol=4)
```

### Figure 3

```{r T90 model plot, echo=FALSE, fig.height = 18, fig.width = 10, fig.align = "center", results = 'hide'}
# full T90 plot with coral images
full.T90.model.fig <- plot_grid(corals, pro.model.fig, carb.model.fig, den.model.fig, chla.model.fig, sum.model.fig, ncol = 1, align = "v", axis = 'lb', rel_heights = c(1,1,1,1,1,1))

full.T90.model.fig
```

```{r T90 SE plot, include=FALSE, fig.height = 10, fig.width = 9, fig.align = "center", results = 'hide'}
# create summary data
T90.sum <- summarySE(data = T90.df, measurevar = "value", groupvars = c("param", "species", "fpco2", "ftemp"), na.rm = TRUE)

# plot total protein
pro.T90.sum <- subset(T90.sum, param=="pro")
pro.T90 <- subset(T90.df, param=="pro")

pro.T90.fig <-ggplot(pro.T90.sum, aes(colour=ftemp, group=ftemp))+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.placement = "outside", legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  ylab("total protein")+
  xlab("")+
  geom_point(data=pro.T90, aes(fpco2, value), position = jitter, alpha=0.3, size=1)+
  geom_errorbar(aes(x = fpco2, ymin=value-se, ymax=value+se, width=0.5), position=dodge2, colour="black")+
  geom_point(aes(fpco2, value), position = dodge2, size=2, shape = 15)+
  scale_colour_manual("Temperature", labels=c("28C", "31C"), values = c("blue", "red"))+
  facet_wrap(~species, scales = "free_y", ncol=4)

# plot carbohydrate
carb.T90.sum <- subset(T90.sum, param=="carb")
carb.T90 <- subset(T90.df, param=="carb")

carb.T90.fig <-ggplot(carb.T90.sum, aes(colour=ftemp, group=ftemp))+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.text.x = element_blank(), legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  ylab("carbohydrate")+
  xlab("")+
  geom_point(data=carb.T90, aes(fpco2, value), position = jitter, alpha=0.3, size=1)+
  geom_errorbar(aes(x = fpco2, ymin=value-se, ymax=value+se, width=0.5), position=dodge2, colour="black")+
  geom_point(aes(fpco2, value), position = dodge2, size=2, shape = 15)+
  scale_colour_manual("Temperature", labels=c("28C", "31C"), values = c("blue", "red"))+
  facet_wrap(~species, scales = "free_y", ncol=4)

# plot symbiont density
den.T90.sum <- subset(T90.sum, param=="den")
den.T90 <- subset(T90.df, param=="den")

den.T90.fig <-ggplot(den.T90.sum, aes(colour=ftemp, group=ftemp))+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.text.x = element_blank(), legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  ylab("symb. density")+
  xlab("")+  
  geom_point(data=den.T90, aes(fpco2, value), position = jitter, alpha=0.3, size=1)+
  geom_errorbar(aes(x = fpco2, ymin=value-se, ymax=value+se, width=0.5), position=dodge2, colour="black")+
  geom_point(aes(fpco2, value), position = dodge2, size=2, shape = 15)+
  scale_colour_manual("Temperature", labels=c("28C", "31C"), values = c("blue", "red"))+
  facet_wrap(~species, scales = "free_y", ncol=4)

# plot chlorophyll
chla.T90.sum <- subset(T90.sum, param=="chla")
chla.T90 <- subset(T90.df, param=="chla")

chla.T90.fig <-ggplot(chla.T90.sum, aes(colour=ftemp, group=ftemp))+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.text.x = element_blank(), legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  xlab("")+
  ylab("chlorophyll")+
  geom_point(data=chla.T90, aes(fpco2, value), position = jitter, alpha=0.3, size=1)+
  geom_errorbar(aes(x = fpco2, ymin=value-se, ymax=value+se, width=0.5), position=dodge2, colour="black")+
  geom_point(aes(fpco2, value), position = dodge2, size=2, shape = 15)+
  scale_colour_manual("Temperature", labels=c("28C", "31C"), values = c("blue", "red"))+
  facet_wrap(~species, scales = "free_y", ncol=4)

# plot colour intensity
sum_bw5.T90.sum <- subset(T90.sum, param=="sum_bw5")
sum_bw5.T90 <- subset(T90.df, param=="sum_bw5")

sum_bw5.T90.fig <-ggplot(sum_bw5.T90.sum, aes(colour=ftemp, group=ftemp))+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.text.x = element_blank(), legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  xlab(alab)+
  ylab("colour intensity")+
  geom_point(data=sum_bw5.T90, aes(fpco2, value), position = jitter, alpha=0.3, size=1)+
  geom_errorbar(aes(x = fpco2, ymin=value-se, ymax=value+se, width=0.5), position=dodge2, colour="black")+
  geom_point(aes(fpco2, value), position = dodge2, size=2, shape = 15)+
  scale_colour_manual("Temperature", labels=c("28C", "31C"), values = c("blue", "red"))+
  facet_wrap(~species, scales = "free_y", ncol=4)


# Combine all the plots
phys_plot<- plot_grid(pro.T90.fig, carb.T90.fig, den.T90.fig, chla.T90.fig, sum_bw5.T90.fig, ncol = 1, labels = c('A', 'B', 'C', 'D', 'E'), label_size = 12)
phys_plot
#
## Create figure name
#fig3 <- paste("T90_noCol_fig", date, sep="_") 
#fig3 <- paste(fig3, ".pdf", sep="") 
#
## save figure as PDF
#pdf(fig3, width = 7, height = 8)
#phys_plot
#dev.set(dev.next())
```
**Figure 3.** Modelled 95% confidence interval of *(a) S. siderea*, *(b) P. strigosa*, *(c) P. astreoides*, and *(d) U. tenuifolia* physiology with individual coral fragment physiology denoted by points. Blue denotes 28C and red denotes 31C, with *p*CO2 treatment along the x axis.
<br/>
<br/>


# **Part 3:** *Bleaching over time (using colour intensity)* 
```{r chla sum5 comparison, fig.height=3, fig.width=10, echo=F, include=F}

# subset by species
df.s <- subset(df, species=="S")
df.p <- subset(df, species=="P")
df.a <- subset(df, species=="A")
df.t <- subset(df, species=="T")

# linear models per species (sum5 * chla)
lm1.s <- summary(lm(chla ~ sum_bw5, data = df.s))
lm1.p <- summary(lm(chla ~ sum_bw5, data = df.p))
lm1.a <- summary(lm(chla ~ sum_bw5, data = df.a))
lm1.t <- summary(lm(chla ~ sum_bw5, data = df.t))

# extract R2 values
lm1.s.R2 <- lm1.s$adj.r.squared
lm1.p.R2 <- lm1.p$adj.r.squared
lm1.a.R2 <- lm1.a$adj.r.squared
lm1.t.R2 <- lm1.t$adj.r.squared

# extract p values
lm1.s.p <- lm1.s$coefficients[2,4]
lm1.p.p <- lm1.p$coefficients[2,4]
lm1.a.p <- lm1.a$coefficients[2,4]
lm1.t.p <- lm1.t$coefficients[2,4]


ggplot(df, aes(x = (sum_bw5 * -1), y = chla, colour = ftemp, shape = fpco2, group = species))+
  geom_point()+
  geom_smooth(method="lm")+
  ylab(clab)+
  theme(legend.position="none")+
  xlab("Sum Colour Intensity")+
  scale_colour_manual("Temperature", values = c("blue", "red"))+
  ggtitle(bquote(atop("Rs"^2 == .(lm1.s.R2)~ ";  Rp"^2 == .(lm1.p.R2)~"; Ra"^2 == .(lm1.a.R2)~ ";  Rt"^2 == .(lm1.t.R2))))+
  facet_wrap(~species, scales = "free_y", ncol = 4)

```

```{r chla red5 comparison, fig.height=3, fig.width=10, echo=F, include=F}

# linear models per species (red5 * chla)
lm2.s <- summary(lm(chla ~ red_bw5, data = df.s))
lm2.p <- summary(lm(chla ~ red_bw5, data = df.p))
lm2.a <- summary(lm(chla ~ red_bw5, data = df.a))
lm2.t <- summary(lm(chla ~ red_bw5, data = df.t))

# extract R2 values
lm2.s.R2 <- lm2.s$adj.r.squared
lm2.p.R2 <- lm2.p$adj.r.squared
lm2.a.R2 <- lm2.a$adj.r.squared
lm2.t.R2 <- lm2.t$adj.r.squared

# extract p values
lm2.s.p <- lm2.s$coefficients[2,4]
lm2.p.p <- lm2.p$coefficients[2,4]
lm2.a.p <- lm2.a$coefficients[2,4]
lm2.t.p <- lm2.t$coefficients[2,4]


ggplot(df, aes(x = (red_bw5 * -1), y = chla, colour = ftemp, shape = fpco2, group = species))+
  geom_point()+
  geom_smooth(method="lm")+
  ylab(clab)+
  theme(legend.position="none")+
  xlab("Red Colour Intensity")+
  scale_colour_manual("Temperature", values = c("blue", "red"))+
  ggtitle(bquote(atop("Rs"^2 == .(lm2.s.R2)~ ";  Rp"^2 == .(lm2.p.R2)~"; Ra"^2 == .(lm2.a.R2)~ ";  Rt"^2 == .(lm2.t.R2))))+
  facet_wrap(~species, scales = "free_y", ncol = 4)

```

```{r chla blue5 comparison, fig.height=3, fig.width=10, echo=F, include=F}

# linear models per species (blue5 * chla)
lm3.s <- summary(lm(chla ~ blue_bw5, data = df.s))
lm3.p <- summary(lm(chla ~ blue_bw5, data = df.p))
lm3.a <- summary(lm(chla ~ blue_bw5, data = df.a))
lm3.t <- summary(lm(chla ~ blue_bw5, data = df.t))

# extract R2 values
lm3.s.R2 <- lm3.s$adj.r.squared
lm3.p.R2 <- lm3.p$adj.r.squared
lm3.a.R2 <- lm3.a$adj.r.squared
lm3.t.R2 <- lm3.t$adj.r.squared

# extract p values
lm3.s.p <- lm3.s$coefficients[2,4]
lm3.p.p <- lm3.p$coefficients[2,4]
lm3.a.p <- lm3.a$coefficients[2,4]
lm3.t.p <- lm3.t$coefficients[2,4]


ggplot(df, aes(x = (blue_bw5 * -1), y = chla, colour = ftemp, shape = fpco2, group = species))+
  geom_point()+
  geom_smooth(method="lm")+
  ylab(clab)+
  theme(legend.position="none")+
  xlab("Blue Colour Intensity")+
  scale_colour_manual("Temperature", values = c("blue", "red"))+
  ggtitle(bquote(atop("Rs"^2 == .(lm3.s.R2)~ ";  Rp"^2 == .(lm3.p.R2)~"; Ra"^2 == .(lm3.a.R2)~ ";  Rt"^2 == .(lm3.t.R2))))+
  facet_wrap(~species, scales = "free_y", ncol = 4)

```

```{r chla green5 comparison, fig.height=3, fig.width=10, echo=F, include=F}

# linear models per species (green5 * chla)
lm4.s <- summary(lm(chla ~ green_bw5, data = df.s))
lm4.p <- summary(lm(chla ~ green_bw5, data = df.p))
lm4.a <- summary(lm(chla ~ green_bw5, data = df.a))
lm4.t <- summary(lm(chla ~ green_bw5, data = df.t))

# extract R2 values
lm4.s.R2 <- lm4.s$adj.r.squared
lm4.p.R2 <- lm4.p$adj.r.squared
lm4.a.R2 <- lm4.a$adj.r.squared
lm4.t.R2 <- lm4.t$adj.r.squared

# extract p values
lm4.s.p <- lm4.s$coefficients[2,4]
lm4.p.p <- lm4.p$coefficients[2,4]
lm4.a.p <- lm4.a$coefficients[2,4]
lm4.t.p <- lm4.t$coefficients[2,4]


ggplot(df, aes(x = (green_bw5 * -1), y = chla, colour = ftemp, shape = fpco2, group = species))+
  geom_point()+
  geom_smooth(method="lm")+
  ylab(clab)+
  theme(legend.position="none")+
  xlab("Green Colour Intensity")+
  scale_colour_manual("Temperature", values = c("blue", "red"))+
  ggtitle(bquote(atop("Rs"^2 == .(lm4.s.R2)~ ";  Rp"^2 == .(lm4.p.R2)~"; Ra"^2 == .(lm4.a.R2)~ ";  Rt"^2 == .(lm4.t.R2))))+
  facet_wrap(~species, scales = "free_y", ncol = 4)

```

```{r den sum5 comparison, fig.height=3, fig.width=10, echo=F, include=F}

# linear models per species (sum5 * den)
lm5.s <- summary(lm(den ~ sum_bw5, data = df.s))
lm5.p <- summary(lm(den ~ sum_bw5, data = df.p))
lm5.a <- summary(lm(den ~ sum_bw5, data = df.a))
lm5.t <- summary(lm(den ~ sum_bw5, data = df.t))

# extract R2 values
lm5.s.R2 <- lm5.s$adj.r.squared
lm5.p.R2 <- lm5.p$adj.r.squared
lm5.a.R2 <- lm5.a$adj.r.squared
lm5.t.R2 <- lm5.t$adj.r.squared

# extract p values
lm5.s.p <- lm5.s$coefficients[2,4]
lm5.p.p <- lm5.p$coefficients[2,4]
lm5.a.p <- lm5.a$coefficients[2,4]
lm5.t.p <- lm5.t$coefficients[2,4]


ggplot(df, aes(x = (sum_bw5 * -1), y = den, colour = ftemp, shape = fpco2, group = species))+
  geom_point()+
  geom_smooth(method="lm")+
  ylab(dlab)+
  theme(legend.position="none")+
  xlab("Sum Colour Intensity")+
  scale_colour_manual("Temperature", values = c("blue", "red"))+
  ggtitle(bquote(atop("Rs"^2 == .(lm5.s.R2)~ ";  Rp"^2 == .(lm5.p.R2)~"; Ra"^2 == .(lm5.a.R2)~ ";  Rt"^2 == .(lm5.t.R2))))+
  facet_wrap(~species, scales = "free_y", ncol = 4)

```

```{r den red5 comparison, fig.height=3, fig.width=10, echo=F, include=F}

# linear models per species (red5 * den)
lm6.s <- summary(lm(den ~ red_bw5, data = df.s))
lm6.p <- summary(lm(den ~ red_bw5, data = df.p))
lm6.a <- summary(lm(den ~ red_bw5, data = df.a))
lm6.t <- summary(lm(den ~ red_bw5, data = df.t))

# extract R2 values
lm6.s.R2 <- lm6.s$adj.r.squared
lm6.p.R2 <- lm6.p$adj.r.squared
lm6.a.R2 <- lm6.a$adj.r.squared
lm6.t.R2 <- lm6.t$adj.r.squared

# extract p values
lm6.s.p <- lm6.s$coefficients[2,4]
lm6.p.p <- lm6.p$coefficients[2,4]
lm6.a.p <- lm6.a$coefficients[2,4]
lm6.t.p <- lm6.t$coefficients[2,4]


ggplot(df, aes(x = (red_bw5 * -1), y = den, colour = ftemp, shape = fpco2, group = species))+
  geom_point()+
  geom_smooth(method="lm")+
  ylab(dlab)+
  theme(legend.position="none")+
  xlab("Red Colour Intensity")+
  scale_colour_manual("Temperature", values = c("blue", "red"))+
  ggtitle(bquote(atop("Rs"^2 == .(lm6.s.R2)~ ";  Rp"^2 == .(lm6.p.R2)~"; Ra"^2 == .(lm6.a.R2)~ ";  Rt"^2 == .(lm6.t.R2))))+
  facet_wrap(~species, scales = "free_y", ncol = 4)

```

```{r den blue5 comparison, fig.height=3, fig.width=10, echo=F, include=F}

# linear models per species (blue5 * den)
lm7.s <- summary(lm(den ~ blue_bw5, data = df.s))
lm7.p <- summary(lm(den ~ blue_bw5, data = df.p))
lm7.a <- summary(lm(den ~ blue_bw5, data = df.a))
lm7.t <- summary(lm(den ~ blue_bw5, data = df.t))

# extract R2 values
lm7.s.R2 <- lm7.s$adj.r.squared
lm7.p.R2 <- lm7.p$adj.r.squared
lm7.a.R2 <- lm7.a$adj.r.squared
lm7.t.R2 <- lm7.t$adj.r.squared

# extract p values
lm7.s.p <- lm7.s$coefficients[2,4]
lm7.p.p <- lm7.p$coefficients[2,4]
lm7.a.p <- lm7.a$coefficients[2,4]
lm7.t.p <- lm7.t$coefficients[2,4]


ggplot(df, aes(x = (blue_bw5 * -1), y = den, colour = ftemp, shape = fpco2, group = species))+
  geom_point()+
  geom_smooth(method="lm")+
  ylab(dlab)+
  theme(legend.position="none")+
  xlab("Blue Colour Intensity")+
  scale_colour_manual("Temperature", values = c("blue", "red"))+
  ggtitle(bquote(atop("Rs"^2 == .(lm7.s.R2)~ ";  Rp"^2 == .(lm7.p.R2)~"; Ra"^2 == .(lm7.a.R2)~ ";  Rt"^2 == .(lm7.t.R2))))+
  facet_wrap(~species, scales = "free_y", ncol = 4)

```

```{r den green5 comparison, fig.height=3, fig.width=10, include=FALSE}

# linear models per species (green5 * den)
lm8.s <- summary(lm(den ~ green_bw5, data = df.s))
lm8.p <- summary(lm(den ~ green_bw5, data = df.p))
lm8.a <- summary(lm(den ~ green_bw5, data = df.a))
lm8.t <- summary(lm(den ~ green_bw5, data = df.t))

# extract R2 values
lm8.s.R2 <- lm8.s$adj.r.squared
lm8.p.R2 <- lm8.p$adj.r.squared
lm8.a.R2 <- lm8.a$adj.r.squared
lm8.t.R2 <- lm8.t$adj.r.squared

# extract p values
lm8.s.p <- lm8.s$coefficients[2,4]
lm8.p.p <- lm8.p$coefficients[2,4]
lm8.a.p <- lm8.a$coefficients[2,4]
lm8.t.p <- lm8.t$coefficients[2,4]


ggplot(df, aes(x = (green_bw5 * -1), y = den, colour = ftemp, shape = fpco2, group = species))+
  geom_point()+
  geom_smooth(method="lm")+
  ylab(dlab)+
  theme(legend.position="none")+
  xlab("Green Colour Intensity")+
  scale_colour_manual("Temperature", values = c("blue", "red"))+
  ggtitle(bquote(atop("Rs"^2 == .(lm8.s.R2)~ ";  Rp"^2 == .(lm8.p.R2)~"; Ra"^2 == .(lm8.a.R2)~ ";  Rt"^2 == .(lm8.t.R2))))+
  facet_wrap(~species, scales = "free_y", ncol = 4)

```

```{r tables of colours, echo=F}
# SSID table for colour intensity
table.s <- data_frame("comparison" = c("chla v sum", "chla v red", "chla v blue", "chla v green", "den v sum", "den v red", "den v blue", "den v green"), "R2" = c(lm1.s.R2, lm2.s.R2, lm3.s.R2, lm4.s.R2, lm5.s.R2, lm6.s.R2, lm7.s.R2, lm8.s.R2), "p.value" = c(lm1.s.p, lm2.s.p, lm3.s.p, lm4.s.p, lm5.s.p, lm6.s.p, lm7.s.p, lm8.s.p))

# PSTR table for colour intensity
table.p <- data_frame("comparison" = c("chla v sum", "chla v red", "chla v blue", "chla v green", "den v sum", "den v red", "den v blue", "den v green"), "R2" = c(lm1.p.R2, lm2.p.R2, lm3.p.R2, lm4.p.R2, lm5.p.R2, lm6.p.R2, lm7.p.R2, lm8.p.R2), "p.value" = c(lm1.p.p, lm2.p.p, lm3.p.p, lm4.p.p, lm5.p.p, lm6.p.p, lm7.p.p, lm8.p.p))

# PAST table for colour intensity
table.a <- data_frame("comparison" = c("chla v sum", "chla v red", "chla v blue", "chla v green", "den v sum", "den v red", "den v blue", "den v green"), "R2" = c(lm1.a.R2, lm2.a.R2, lm3.a.R2, lm4.a.R2, lm5.a.R2, lm6.a.R2, lm7.a.R2, lm8.a.R2), "p.value" = c(lm1.a.p, lm2.a.p, lm3.a.p, lm4.a.p, lm5.a.p, lm6.a.p, lm7.a.p, lm8.a.p))

# UTEN table for colour intensity
table.t <- data_frame("comparison" = c("chla v sum", "chla v red", "chla v blue", "chla v green", "den v sum", "den v red", "den v blue", "den v green"), "R2" = c(lm1.t.R2, lm2.t.R2, lm3.t.R2, lm4.t.R2, lm5.t.R2, lm6.t.R2, lm7.t.R2, lm8.t.R2), "p.value" = c(lm1.t.p, lm2.t.p, lm3.t.p, lm4.t.p, lm5.t.p, lm6.t.p, lm7.t.p, lm8.t.p))

table.s$R2 <- round(table.s$R2, 3)
table.p$R2 <- round(table.p$R2, 3)
table.a$R2 <- round(table.a$R2, 3)
table.t$R2 <- round(table.t$R2, 3)

table.s$p.value <- round(table.s$p.value, 4)
table.p$p.value <- round(table.p$p.value, 4)
table.a$p.value <- round(table.a$p.value, 4)
table.t$p.value <- round(table.t$p.value, 4)

table.full <- cbind(table.s, table.p, table.a, table.t)

kable(table.full, caption = "Table 1. Colour Intensity Linear Models") %>%
  kable_styling(font_size = 12, full_width = F) %>% 
  column_spec(1:3, background = "lightgrey") %>%
  column_spec(7:9, background = "lightgrey") %>% 
  column_spec(1, bold = T) %>% 
  column_spec(4, bold = T) %>% 
  column_spec(7, bold = T) %>% 
  column_spec(10, bold = T) %>%
  add_header_above(c("SSID" = 3, "PSTR" = 3, "PAST" = 3, "UTEN" = 3))

```
<br/>

### Figure 4

```{r col best figs, fig.height=3, fig.width=10, echo=F}

# SSID with density (specifically red)
s.sumplot <- ggplot(df.s, aes(x = (red_bw5 * -1), y = den, colour = ftemp, shape = fpco2, group = species))+
  geom_point()+
  geom_smooth(method="lm", colour = "black", se=F)+
  ylab(dlab)+
  theme(legend.position="none")+
  xlab("Red Colour Intensity")+
  scale_colour_manual("Temperature", values = c("blue", "red"))+
  ggtitle(bquote(bold("SSID Best Fit:")~ "R"^2 == .(lm6.s.R2)))

# PSTR best with red chla, but good with any (except blue)
p.sumplot <- ggplot(df.p, aes(x = (red_bw5 * -1), y = chla, colour = ftemp, shape = fpco2, group = species))+
  geom_point()+
  geom_smooth(method="lm", colour = "black", se=F)+
  ylab(clab)+
  theme(legend.position="none")+
  xlab("Red Colour Intensity")+
  scale_colour_manual("Temperature", values = c("blue", "red"))+
  ggtitle(bquote(bold("PSTR Best Fit:")~ "R"^2 == .(lm2.p.R2)))

# PAST chla
a.sumplot <- ggplot(df.a, aes(x = (sum_bw5 * -1), y = chla, colour = ftemp, shape = fpco2, group = species))+
  geom_point()+
  geom_smooth(method="lm", colour = "black", se=F)+
  ylab(clab)+
  theme(legend.position="none")+
  xlab("Sum Colour Intensity")+
  scale_colour_manual("Temperature", values = c("blue", "red"))+
  ggtitle(bquote(bold("PAST Best Fit:")~ "R"^2 == .(lm1.a.R2)))

plot_grid(s.sumplot, p.sumplot, a.sumplot, labels="auto", nrow = 1)

```
**Figure 4.** Text goes here
<br/>

Notes:

* Red best predicts denisty, but colour overall predicts density better than chlorophyll in SSID
* Red best predicts chlorophyll, but any channel (with the exception of blue) predicts both density and chlorophyll in PSTRs
* Colour intensity predicts chlorophyll, but not density in PAST
* No colour analysis predicts UTEN bleaching

<br/>

### Figure 5
```{r sum PAST fig, echo=FALSE, fig.height = 3, fig.width = 11, fig.align = "center", results = 'hide'}

col.df <- df[,c(1:12,17:36)]
col.df.red <- col.df[,c(1:12,14,18,22,26,30)] # red channel

# sum fig for PAST
col.df <- col.df[,c(1:13,17,21,25,29)] # sum channels
col.df <- subset(col.df, T0_T90=="T90")
col.df <- gather(col.df, col.metric, value, sum_bw5:sum_bw4) # make column of parameter and value
col.df$col.metric <- gsub("sum_bw", "tp", col.df$col.metric)
col.df$value <- col.df$value * -1
col.df$fpco2 <- factor(col.df$fpco2, c("280", "400", "700", "2800"))
col.df <- subset(col.df, species == "A")

col.sum <- summarySE(data = col.df, measurevar = "value", groupvars = c("col.metric", "fpco2", "ftemp"), na.rm = TRUE)

colour.fig <-ggplot(col.sum, aes(colour=ftemp, group=ftemp))+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.placement = "outside", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  geom_point(data=col.df, aes(col.metric, value), position = jitter, alpha=0.3, size=1.5, shape = 20)+
  geom_line(aes(col.metric, value), position = dodge, size=0.5)+
  xlab("time point")+
  ylab("")+
  ggtitle("(a) Sum Channel Colour Intensity")+
  geom_errorbar(aes(x = col.metric, ymin=value-se, ymax=value+se, width=0.3), position=dodge, colour="black")+
  geom_point(aes(col.metric, value), position = dodge, size=2)+
  scale_colour_manual("Temperature", labels=c("28C", "31C"), values = c("blue", "red"))+
  facet_grid(~fpco2, scales = "free_y", labeller = as_labeller( c("280" = "280 uatm", "400" = "400 uatm", "700" = "700 uatm", "2800" = "2800 uatm")))
colour.fig

```

```{r red SSID PSTR fig, echo=FALSE, fig.height = 5.5, fig.width = 11, fig.align = "center", results = 'hide'}

# red fig for SSID and PSTR
col.df.red <- subset(col.df.red, T0_T90=="T90")
col.df.red <- gather(col.df.red, col.metric, value, red_bw1:red_bw4) # make column of parameter and value
col.df.red$col.metric <- gsub("red_bw", "tp", col.df.red$col.metric)
col.df.red$value <- col.df.red$value * -1
col.df.red$fpco2 <- factor(col.df.red$fpco2, c("280", "400", "700", "2800"))
col.df.red <- subset(col.df.red, species != "A")
col.df.red <- subset(col.df.red, species != "T")

red.sum <- summarySE(data = col.df.red, measurevar = "value", groupvars = c("col.metric", "species", "fpco2", "ftemp"), na.rm = TRUE)

red.fig <-ggplot(red.sum, aes(colour=ftemp, group=ftemp))+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.placement = "outside", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  geom_point(data=col.df.red, aes(col.metric, value), position = jitter, alpha=0.3, size=1.5, shape = 20)+
  geom_line(aes(col.metric, value), position = dodge, size=0.5)+
  xlab("time point")+
  ylab("")+
  ggtitle("(b) Red Channel Colour Intensity")+
  geom_errorbar(aes(x = col.metric, ymin=value-se, ymax=value+se, width=0.3), position=dodge, colour="black")+
  geom_point(aes(col.metric, value), position = dodge, size=2)+
  scale_colour_manual("Temperature", labels=c("28C", "31C"), values = c("blue", "red"))+
  facet_grid(species~fpco2, scales = "free_y", labeller = as_labeller( c("280" = "280 uatm", "400" = "400 uatm", "700" = "700 uatm", "2800" = "2800 uatm", "S" = "SSID", "P" = "PSTR")))
red.fig

```


**Figure 5.** Text goes here
<br/>
<br/>
<br/>
<br/>


# **Part 4:** *Comparison of physiological parameters*

<br/>

### Figure 6: *Siderastrea siderea*
*Models were fit by either temperature (blue/red) or pCO2 (pink/green/orange/darkred) depending on best linear model fit*

```{r SSID comp model, echo=FALSE}

# adjust dataframe for SSID physiology parameters only
phys.s <- df.s[ , -c(13, 17:33, 35:36)] 
phys.s <- subset(phys.s, T0_T90 == "T90")
phys.s$red <- phys.s$red_bw5 * -1 # inverse of colour intensity so that lower values represent 'bleaching'
phys.s$red_bw5 <- NULL

# reorder and revalue factors 
phys.s$fpco2 <- factor(phys.s$fpco2, c("280", "400", "700", "2800"))
phys.s$species <- revalue(x = phys.s$species, c("S" = "SSID", "P" = "PSTR", "A" = "PAST", "T" = "UTEN"))


# Perform simple linear models (only showing best fit)
pro.carb.mod.s <- lm(carb ~ pro * ftemp, data = phys.s)
pro.den.mod.s <- lm(den ~ pro * ftemp, data = phys.s) 
pro.chla.mod.s <- lm(chla ~ pro * fpco2, data = phys.s)
pro.red.mod.s <- lm(red ~ pro * fpco2, data = phys.s)
carb.den.mod.s <- lm(den ~ carb * fpco2, data = phys.s)
carb.chla.mod.s <- lm(chla ~ carb * fpco2, data = phys.s)
carb.red.mod.s <- lm(red ~ carb * fpco2, data = phys.s)
den.chla.mod.s <- lm(chla ~ den * fpco2, data = phys.s)
den.red.mod.s <- lm(red ~ den * fpco2, data = phys.s)
chla.red.mod.s <- lm(red ~ chla * fpco2, data = phys.s)

# extract R2 for best fit models
pc.R2.s  <- summary(pro.carb.mod.s)$adj.r.squared
pd.R2.s  <- summary(pro.den.mod.s)$adj.r.squared
pa.R2.s  <- summary(pro.chla.mod.s)$adj.r.squared
pr.R2.s  <- summary(pro.red.mod.s)$adj.r.squared
cd.R2.s  <- summary(carb.den.mod.s)$adj.r.squared
ca.R2.s  <- summary(carb.chla.mod.s)$adj.r.squared
cr.R2.s  <- summary(carb.red.mod.s)$adj.r.squared
da.R2.s  <- summary(den.chla.mod.s)$adj.r.squared
dr.R2.s  <- summary(den.red.mod.s)$adj.r.squared
ar.R2.s  <- summary(chla.red.mod.s)$adj.r.squared

```
```{r SSID comp figures, echo=FALSE, fig.height=8, fig.width=10}

# individual figures comparing physiology parameters
SSID.pro.carb <- ggplot(phys.s, aes(x = pro, y = carb, colour = ftemp, shape = fpco2, group = ftemp))+
  geom_point()+
  ylab("Carbohydrate")+
  xlab("Protein")+
  ggtitle(bquote(bold("R"^2 == .(pc.R2.s))))+
  theme(legend.position = "none")+
  geom_smooth(method = 'lm', se = FALSE)+
  scale_colour_manual("Temperature", values = c("blue", "red"))+
  scale_shape_manual("pCO2", values = c(18,15,16,17))

SSID.pro.den <- ggplot(phys.s, aes(x = pro, y = den, colour = ftemp, shape = fpco2, group = ftemp))+
  geom_point()+
  ylab("Density")+
  xlab("Protein")+
  ggtitle(bquote(bold("R"^2 == .(pd.R2.s))))+
  theme(legend.position = "none")+
  geom_smooth(method = 'lm', se = FALSE)+
  scale_colour_manual("Temperature", values = c("blue", "red"))+
  scale_shape_manual("pCO2", values = c(18,15,16,17))
  
SSID.pro.chla <- ggplot(phys.s, aes(x = pro, y = chla, colour = fpco2, shape = ftemp, group = fpco2))+
  geom_point()+
  ylab("Chlorophyll")+
  xlab("Protein")+
  ggtitle(bquote(bold("R"^2 == .(pa.R2.s))))+
  theme(legend.position = "none")+
  geom_smooth(method = 'lm', se = FALSE)+
  scale_colour_manual("pCO2", values = c("lightpink", "seagreen", "orange", "darkred"))+
  scale_shape_manual("Temperature", values = c(17,15))

SSID.pro.red <- ggplot(phys.s, aes(x = pro, y = red, colour = fpco2, shape = ftemp, group = fpco2))+
  geom_point()+
  ylab("Colour Intensity")+
  xlab("Protein")+
  ggtitle(bquote(bold("R"^2 == .(pr.R2.s))))+
  theme(legend.position = "none")+
  geom_smooth(method = 'lm', se = FALSE)+
  scale_colour_manual("pCO2", values = c("lightpink", "seagreen", "orange", "darkred"))+
  scale_shape_manual("Temperature", values = c(17,15))

SSID.carb.den <- ggplot(phys.s, aes(x = carb, y = den, colour = fpco2, shape = ftemp, group = fpco2))+
  geom_point()+
  ylab("Density")+
  xlab("Carbohydrate")+
  ggtitle(bquote(bold("R"^2 == .(cd.R2.s))))+
  theme(legend.position = "none")+
  geom_smooth(method = 'lm', se = FALSE)+
  scale_colour_manual("pCO2", values = c("lightpink", "seagreen", "orange", "darkred"))+
  scale_shape_manual("Temperature", values = c(17,15))

SSID.carb.chla <- ggplot(phys.s, aes(x = carb, y = chla, colour = fpco2, shape = ftemp, group = fpco2))+
  geom_point()+
  ylab("Chlorophyll")+
  xlab("Carbohydrate")+
  ggtitle(bquote(bold("R"^2 == .(ca.R2.s))))+
  theme(legend.position = "none")+
  geom_smooth(method = 'lm', se = FALSE)+
  scale_colour_manual("pCO2", values = c("lightpink", "seagreen", "orange", "darkred"))+
  scale_shape_manual("Temperature", values = c(17,15))

SSID.carb.red <- ggplot(phys.s, aes(x = carb, y = red, colour = fpco2, shape = ftemp, group = fpco2))+
  geom_point()+
  ylab("Colour Intensity")+
  xlab("Carbohydrate")+
  ggtitle(bquote(bold("R"^2 == .(cr.R2.s))))+
  theme(legend.position = "none")+
  geom_smooth(method = 'lm', se = FALSE)+
  scale_colour_manual("pCO2", values = c("lightpink", "seagreen", "orange", "darkred"))+
  scale_shape_manual("Temperature", values = c(17,15))

SSID.den.chla <- ggplot(phys.s, aes(x = den, y = chla, colour = fpco2, shape = ftemp, group = fpco2))+
  geom_point()+
  ylab("Chlorophyll")+
  xlab("Density")+
  ggtitle(bquote(bold("R"^2 == .(da.R2.s))))+
  theme(legend.position = "none")+
  geom_smooth(method = 'lm', se = FALSE)+
  scale_colour_manual("pCO2", values = c("lightpink", "seagreen", "orange", "darkred"))+
  scale_shape_manual("Temperature", values = c(17,15))

SSID.den.red <- ggplot(phys.s, aes(x = den, y = red, colour = fpco2, shape = ftemp, group = fpco2))+
  geom_point()+
  ylab("Colour Intensity")+
  xlab("Density")+
  ggtitle(bquote(bold("R"^2 == .(dr.R2.s))))+
  theme(legend.position = "none")+
  geom_smooth(method = 'lm', se = FALSE)+
  scale_colour_manual("pCO2", values = c("lightpink", "seagreen", "orange", "darkred"))+
  scale_shape_manual("Temperature", values = c(17,15))

SSID.chla.red <- ggplot(phys.s, aes(x = chla, y = red, colour = fpco2, shape = ftemp, group = fpco2))+
  geom_point()+
  ylab("Colour Intensity")+
  xlab("Chlorophyll")+
  ggtitle(bquote(bold("R"^2 == .(ar.R2.s))))+
  theme(legend.position = "none")+
  geom_smooth(method = 'lm', se = FALSE)+
  scale_colour_manual("pCO2", values = c("lightpink", "seagreen", "orange", "darkred"))+
  scale_shape_manual("Temperature", values = c(17,15))


plot_grid(SSID.den.chla, SSID.carb.chla, SSID.pro.chla, SSID.pro.den, SSID.den.red, SSID.carb.den, SSID.pro.carb, SSID.chla.red, SSID.pro.red, SSID.carb.red, labels = c("a)", "b)", "c)", "d)", "e)", "f)", "g)", "h)", "i)", "j)"))

```

**Figure 6.** Text goes here

<br/>

### Figure 7: *Pseudodiploria strigosa*
*Models were fit by overall correlation (black), temperature (blue/red), or pCO2 (pink/green/orange/darkred) depending on best linear model fit*
  
```{r PSTR comp model, echo=FALSE}

# adjust dataframe for PSTR physiology parameters only
phys.p <- df.p[ , -c(13, 17:33, 35:36)] 
phys.p <- subset(phys.p, T0_T90 == "T90")
phys.p$red <- phys.p$red_bw5 * -1 # inverse of colour intensity so that lower values represent 'bleaching'
phys.p$red_bw5 <- NULL

# reorder and revalue factors 
phys.p$fpco2 <- factor(phys.p$fpco2, c("280", "400", "700", "2800"))


# Perform simple linear models (only showing best fit)
pro.carb.mod.s <- lm(carb ~ pro, data = phys.p)
pro.den.mod.s <- lm(den ~ pro * ftemp, data = phys.p) 
pro.chla.mod.s <- lm(chla ~ pro * fpco2, data = phys.p) 
pro.red.mod.s <- lm(red ~ pro * ftemp, data = phys.p) 
carb.den.mod.s <- lm(den ~ carb * ftemp, data = phys.p) 
carb.chla.mod.s <- lm(chla ~ carb * fpco2, data = phys.p)
carb.red.mod.s <- lm(red ~ carb * ftemp, data = phys.p)
den.chla.mod.s <- lm(chla ~ den * fpco2, data = phys.p)
den.red.mod.s <- lm(red ~ den * ftemp, data = phys.p)
chla.red.mod.s <- lm(chla ~ red * fpco2, data = phys.p)

# extract R2 for best fit models
pc.R2.s  <- summary(pro.carb.mod.s)$adj.r.squared
pd.R2.s  <- summary(pro.den.mod.s)$adj.r.squared
pa.R2.s  <- summary(pro.chla.mod.s)$adj.r.squared
pr.R2.s  <- summary(pro.red.mod.s)$adj.r.squared
cd.R2.s  <- summary(carb.den.mod.s)$adj.r.squared
ca.R2.s  <- summary(carb.chla.mod.s)$adj.r.squared
cr.R2.s  <- summary(carb.red.mod.s)$adj.r.squared
da.R2.s  <- summary(den.chla.mod.s)$adj.r.squared
dr.R2.s  <- summary(den.red.mod.s)$adj.r.squared
ar.R2.s  <- summary(chla.red.mod.s)$adj.r.squared

```
```{r PSTR comp figures, echo=FALSE, fig.height=8, fig.width=10}

# individual figures comparing physiology parameters
PSTR.pro.carb <- ggplot(phys.p, aes(x = pro, y = carb, group = species))+
  geom_point()+
  ylab("Carbohydrate")+
  xlab("Protein")+
  ggtitle(bquote(bold("R"^2 == .(pc.R2.s))))+
  theme(legend.position = "none")+
  geom_smooth(method = 'lm', se = FALSE, colour = "black")

PSTR.pro.den <- ggplot(phys.p, aes(x = pro, y = den, colour = ftemp, shape = fpco2, group = ftemp))+
  geom_point()+
  ylab("Density")+
  xlab("Protein")+
  ggtitle(bquote(bold("R"^2 == .(pd.R2.s))))+
  theme(legend.position = "none")+
  geom_smooth(method = 'lm', se = FALSE)+
  scale_colour_manual("Temperature", values = c("blue", "red"))+
  scale_shape_manual("pCO2", values = c(18,15,16,17))

PSTR.pro.chla <- ggplot(phys.p, aes(x = pro, y = chla, colour = fpco2, shape = ftemp, group = fpco2))+
  geom_point()+
  ylab("Chlorophyll")+
  xlab("Protein")+
  ggtitle(bquote(bold("R"^2 == .(pa.R2.s))))+
  theme(legend.position = "none")+
  geom_smooth(method = 'lm', se = FALSE)+
  scale_colour_manual("pCO2", values = c("lightpink", "seagreen", "orange", "darkred"))+
  scale_shape_manual("Temperature", values = c(17,15))

PSTR.pro.red <- ggplot(phys.p, aes(x = pro, y = red, colour = ftemp, shape = fpco2, group = ftemp))+
  geom_point()+
  ylab("Colour Intensity")+
  xlab("Protein")+
  ggtitle(bquote(bold("R"^2 == .(pr.R2.s))))+
  theme(legend.position = "none")+
  geom_smooth(method = 'lm', se = FALSE)+
  scale_colour_manual("Temperature", values = c("blue", "red"))+
  scale_shape_manual("pCO2", values = c(18,15,16,17))

PSTR.carb.den <- ggplot(phys.p, aes(x = carb, y = den, colour = ftemp, shape = fpco2, group = ftemp))+
  geom_point()+
  ylab("Density")+
  xlab("Carbohydrate")+
  ggtitle(bquote(bold("R"^2 == .(cd.R2.s))))+
  theme(legend.position = "none")+
  geom_smooth(method = 'lm', se = FALSE)+
  scale_colour_manual("Temperature", values = c("blue", "red"))+
  scale_shape_manual("pCO2", values = c(18,15,16,17))

PSTR.carb.chla <- ggplot(phys.p, aes(x = carb, y = chla, colour = fpco2, shape = ftemp, group = fpco2))+
  geom_point()+
  ylab("Chlorophyll")+
  xlab("Carbohydrate")+
  ggtitle(bquote(bold("R"^2 == .(ca.R2.s))))+
  theme(legend.position = "none")+
  geom_smooth(method = 'lm', se = FALSE)+
  scale_colour_manual("pCO2", values = c("lightpink", "seagreen", "orange", "darkred"))+
  scale_shape_manual("Temperature", values = c(17,15))

PSTR.carb.red <- ggplot(phys.p, aes(x = carb, y = red, colour = ftemp, shape = fpco2, group = ftemp))+
  geom_point()+
  ylab("Colour Intensity")+
  xlab("Carbohydrate")+
  ggtitle(bquote(bold("R"^2 == .(cr.R2.s))))+
  theme(legend.position = "none")+
  geom_smooth(method = 'lm', se = FALSE)+
  scale_colour_manual("Temperature", values = c("blue", "red"))+
  scale_shape_manual("pCO2", values = c(18,15,16,17))

PSTR.den.chla <- ggplot(phys.p, aes(x = den, y = chla, colour = fpco2, shape = ftemp, group = fpco2))+
  geom_point()+
  ylab("Chlorophyll")+
  xlab("Density")+
  ggtitle(bquote(bold("R"^2 == .(da.R2.s))))+
  theme(legend.position = "none")+
  geom_smooth(method = 'lm', se = FALSE)+
  scale_colour_manual("pCO2", values = c("lightpink", "seagreen", "orange", "darkred"))+
  scale_shape_manual("Temperature", values = c(17,15))

PSTR.den.red <- ggplot(phys.p, aes(x = den, y = red, colour = ftemp, shape = fpco2, group = ftemp))+
  geom_point()+
  ylab("Colour Intensity")+
  xlab("Density")+
  ggtitle(bquote(bold("R"^2 == .(dr.R2.s))))+
  theme(legend.position = "none")+
  geom_smooth(method = 'lm', se = FALSE)+
  scale_colour_manual("Temperature", values = c("blue", "red"))+
  scale_shape_manual("pCO2", values = c(18,15,16,17))

PSTR.chla.red <- ggplot(phys.p, aes(x = chla, y = red, colour = fpco2, shape = ftemp, group = fpco2))+
  geom_point()+
  ylab("Colour Intensity")+
  xlab("Chlorophyll")+
  ggtitle(bquote(bold("R"^2 == .(ar.R2.s))))+
  theme(legend.position = "none")+
  geom_smooth(method = 'lm', se = FALSE)+
  scale_colour_manual("pCO2", values = c("lightpink", "seagreen", "orange", "darkred"))+
  scale_shape_manual("Temperature", values = c(17,15))


plot_grid(PSTR.carb.chla, PSTR.chla.red, PSTR.den.red, PSTR.carb.red, PSTR.den.chla, PSTR.pro.red, PSTR.carb.den, PSTR.pro.carb, PSTR.pro.den, PSTR.pro.chla, labels = c("a)", "b)", "c)", "d)", "e)", "f)", "g)", "h)", "i)", "j)"))

```

**Figure 7.** Text goes here

# *Working analyses*

## Preliminary statistics (basic linear model and anova)
```{r, echo = FALSE}
# Select for only T90 values and remove excess colour intensity columns (only sum_T90)
df.stat <- subset(df, T0_T90=="T90")
df.stat <- df.stat[,-c(18:36)]
df.stat$fpco2 <- factor(df.stat$fpco2, levels = c("400", "280", "700", "2800"))
df.stat$sum.in <- df.stat$sum_bw5 * -1

sid.stat <- subset(df.stat, species=="S")
dip.stat <- subset(df.stat, species=="P")
por.stat <- subset(df.stat, species=="A")
ten.stat <- subset(df.stat, species=="T")

# Basic linear models for SSID
sid.carb.lm <- lm <- lm(carb ~ ftemp + fpco2 + reef, data=sid.stat)
sid.pro.lm <- lm <- lm(pro ~ ftemp + fpco2 + reef + reef:ftemp, data=sid.stat)
sid.den.lm <- lm <- lm(den ~ ftemp + fpco2 + reef + reef:ftemp, data=sid.stat)
sid.chla.lm <- lm <- lm(chla ~ ftemp + fpco2 + reef, data=sid.stat)
sid.col.lm <- lm <- lm(sum.in ~ ftemp + fpco2 + reef, data=sid.stat)


sid.stat.df <- data.frame("Parameter" = c("Carbohydrate", "Protein", "Symbiont Density", "Chlorophyll a", "Colour Intensity"))

sid.stat.df$`Temperature` <- round(c(summary(sid.carb.lm)$coefficients[2,4],
                                       summary(sid.pro.lm)$coefficients[2,4],
                                       summary(sid.den.lm)$coefficients[2,4], 
                                       summary(sid.chla.lm)$coefficients[2,4],
                                       summary(sid.col.lm)$coefficients[2,4]), 4)

sid.stat.df$`280 pCO2` <- round(c(summary(sid.carb.lm)$coefficients[3,4],
                                       summary(sid.pro.lm)$coefficients[3,4],
                                       summary(sid.den.lm)$coefficients[3,4], 
                                       summary(sid.chla.lm)$coefficients[3,4],
                                       summary(sid.col.lm)$coefficients[3,4]), 4)

sid.stat.df$`700 pCO2` <- round(c(summary(sid.carb.lm)$coefficients[4,4],
                                       summary(sid.pro.lm)$coefficients[4,4],
                                       summary(sid.den.lm)$coefficients[4,4], 
                                       summary(sid.chla.lm)$coefficients[4,4],
                                       summary(sid.col.lm)$coefficients[4,4]), 4)

sid.stat.df$`2800 pCO2` <- round(c(summary(sid.carb.lm)$coefficients[5,4],
                                       summary(sid.pro.lm)$coefficients[5,4],
                                       summary(sid.den.lm)$coefficients[5,4], 
                                       summary(sid.chla.lm)$coefficients[5,4],
                                       summary(sid.col.lm)$coefficients[5,4]), 4)

sid.stat.df$`Reef Environment` <- round(c(summary(sid.carb.lm)$coefficients[6,4],
                                       summary(sid.pro.lm)$coefficients[6,4],
                                       summary(sid.den.lm)$coefficients[6,4], 
                                       summary(sid.chla.lm)$coefficients[6,4],
                                       summary(sid.col.lm)$coefficients[6,4]), 4)    

sid.stat.df$`Temperature x Reef` <-  c("NA",
                                       round(summary(sid.pro.lm)$coefficients[7,4], 4),
                                       round(summary(sid.den.lm)$coefficients[7,4], 4), 
                                       "NA",
                                       "NA")   

sid.stat.df2 <- data.frame(t(sid.stat.df[-1]))
colnames(sid.stat.df2) <- sid.stat.df[, 1]

sid.stat.df2$Carbohydrate <- as.numeric(as.character(sid.stat.df2$Carbohydrate))
sid.stat.df2$Protein <- as.numeric(as.character(sid.stat.df2$Protein))
sid.stat.df2$`Symbiont Density` <- as.numeric(as.character(sid.stat.df2$`Symbiont Density`))
sid.stat.df2$`Chlorophyll a` <- as.numeric(as.character(sid.stat.df2$`Chlorophyll a`))
sid.stat.df2$`Colour Intensity` <- as.numeric(as.character(sid.stat.df2$`Colour Intensity`))

kable(sid.stat.df2, caption = "SSID linear models p-values") %>%
  kable_styling(font_size = 12, full_width = F) %>% 
  row_spec(0, background = "lightgrey") %>% 
  column_spec(1, italic = T, color = "black", background = "lightgrey") %>% 
  column_spec(2:3, color = "#333333", background ="#FF9999") %>%
  column_spec(4:6, color = "#333333", background = "#99CC66")

```

```{r, echo = FALSE}
# Basic linear models for PSTR
dip.carb.lm <- lm <- lm(carb ~ ftemp + fpco2 + reef, data=dip.stat)
dip.pro.lm <- lm <- lm(pro ~ ftemp + fpco2 + reef, data=dip.stat)
dip.den.lm <- lm <- lm(den ~ ftemp + fpco2 + reef + ftemp:reef, data=dip.stat)
dip.chla.lm <- lm <- lm(chla ~ ftemp + fpco2 + reef, data=dip.stat)
dip.col.lm <- lm <- lm(sum.in ~ ftemp + fpco2 + reef + ftemp:reef, data=dip.stat)


dip.stat.df <- data.frame("Parameter" = c("Carbohydrate", "Protein", "Symbiont Density", "Chlorophyll a", "Colour Intensity"))

dip.stat.df$`Temperature` <- round(c(summary(dip.carb.lm)$coefficients[2,4],
                                       summary(dip.pro.lm)$coefficients[2,4],
                                       summary(dip.den.lm)$coefficients[2,4], 
                                       summary(dip.chla.lm)$coefficients[2,4],
                                       summary(dip.col.lm)$coefficients[2,4]), 4)

dip.stat.df$`280 pCO2` <- round(c(summary(dip.carb.lm)$coefficients[3,4],
                                       summary(dip.pro.lm)$coefficients[3,4],
                                       summary(dip.den.lm)$coefficients[3,4], 
                                       summary(dip.chla.lm)$coefficients[3,4],
                                       summary(dip.col.lm)$coefficients[3,4]), 4)

dip.stat.df$`700 pCO2` <- round(c(summary(dip.carb.lm)$coefficients[4,4],
                                       summary(dip.pro.lm)$coefficients[4,4],
                                       summary(dip.den.lm)$coefficients[4,4], 
                                       summary(dip.chla.lm)$coefficients[4,4],
                                       summary(dip.col.lm)$coefficients[4,4]), 4)

dip.stat.df$`2800 pCO2` <- round(c(summary(dip.carb.lm)$coefficients[5,4],
                                       summary(dip.pro.lm)$coefficients[5,4],
                                       summary(dip.den.lm)$coefficients[5,4], 
                                       summary(dip.chla.lm)$coefficients[5,4],
                                       summary(dip.col.lm)$coefficients[5,4]), 4)

dip.stat.df$`Reef Environment` <- round(c(summary(dip.carb.lm)$coefficients[6,4],
                                       summary(dip.pro.lm)$coefficients[6,4],
                                       summary(dip.den.lm)$coefficients[6,4], 
                                       summary(dip.chla.lm)$coefficients[6,4],
                                       summary(dip.col.lm)$coefficients[6,4]), 4)    

dip.stat.df$`Temperature x Reef` <-  c("NA",
                                       "NA",
                                       round(summary(dip.den.lm)$coefficients[7,4], 4), 
                                       "NA",
                                       round(summary(dip.col.lm)$coefficients[7,4], 4))  

dip.stat.df2 <- data.frame(t(dip.stat.df[-1]))
colnames(dip.stat.df2) <- dip.stat.df[, 1]

dip.stat.df2$Carbohydrate <- as.numeric(as.character(dip.stat.df2$Carbohydrate))
dip.stat.df2$Protein <- as.numeric(as.character(dip.stat.df2$Protein))
dip.stat.df2$`Symbiont Density` <- as.numeric(as.character(dip.stat.df2$`Symbiont Density`))
dip.stat.df2$`Chlorophyll a` <- as.numeric(as.character(dip.stat.df2$`Chlorophyll a`))
dip.stat.df2$`Colour Intensity` <- as.numeric(as.character(dip.stat.df2$`Colour Intensity`))

kable(dip.stat.df2, caption = "PSTR linear models p-values") %>%
  kable_styling(font_size = 12, full_width = F) %>% 
  row_spec(0, background = "lightgrey") %>% 
  column_spec(1, italic = T, color = "black", background = "lightgrey") %>% 
  column_spec(2:3, color = "#333333", background ="#FF9999") %>%
  column_spec(4:6, color = "#333333", background = "#99CC66")

```

```{r, echo = FALSE}
# Basic linear models for PAST
por.carb.lm <- lm <- lm(carb ~ ftemp + fpco2 + reef, data=por.stat)
por.pro.lm <- lm <- lm(pro ~ ftemp + fpco2 + reef, data=por.stat)
por.den.lm <- lm <- lm(den ~ ftemp + fpco2 + reef , data=por.stat)
por.chla.lm <- lm <- lm(chla ~ ftemp + fpco2 + reef + ftemp:fpco2, data=por.stat)
por.col.lm <- lm <- lm(sum.in ~ ftemp + fpco2 + reef, data=por.stat)


por.stat.df <- data.frame("Parameter" = c("Carbohydrate", "Protein", "Symbiont Density", "Chlorophyll a", "Colour Intensity"))

por.stat.df$`Temperature` <- round(c(summary(por.carb.lm)$coefficients[2,4],
                                       summary(por.pro.lm)$coefficients[2,4],
                                       summary(por.den.lm)$coefficients[2,4], 
                                       summary(por.chla.lm)$coefficients[2,4],
                                       summary(por.col.lm)$coefficients[2,4]), 4)

por.stat.df$`280 pCO2` <- round(c(summary(por.carb.lm)$coefficients[3,4],
                                       summary(por.pro.lm)$coefficients[3,4],
                                       summary(por.den.lm)$coefficients[3,4], 
                                       summary(por.chla.lm)$coefficients[3,4],
                                       summary(por.col.lm)$coefficients[3,4]), 4)

por.stat.df$`700 pCO2` <- round(c(summary(por.carb.lm)$coefficients[4,4],
                                       summary(por.pro.lm)$coefficients[4,4],
                                       summary(por.den.lm)$coefficients[4,4], 
                                       summary(por.chla.lm)$coefficients[4,4],
                                       summary(por.col.lm)$coefficients[4,4]), 4)

por.stat.df$`2800 pCO2` <- round(c(summary(por.carb.lm)$coefficients[5,4],
                                       summary(por.pro.lm)$coefficients[5,4],
                                       summary(por.den.lm)$coefficients[5,4], 
                                       summary(por.chla.lm)$coefficients[5,4],
                                       summary(por.col.lm)$coefficients[5,4]), 4)

por.stat.df$`Reef Environment` <- round(c(summary(por.carb.lm)$coefficients[6,4],
                                       summary(por.pro.lm)$coefficients[6,4],
                                       summary(por.den.lm)$coefficients[6,4], 
                                       summary(por.chla.lm)$coefficients[6,4],
                                       summary(por.col.lm)$coefficients[6,4]), 4)    

por.stat.df$`Temperature x 280 pCO2` <-  c("NA",
                                       "NA",
                                       "NA", 
                                       summary(por.chla.lm)$coefficients[7,4],
                                       "NA")  

por.stat.df$`Temperature x 700 pCO2` <-  c("NA",
                                       "NA",
                                       "NA", 
                                       summary(por.chla.lm)$coefficients[8,4],
                                       "NA") 

por.stat.df$`Temperature x 2800 pCO2` <-  c("NA",
                                       "NA",
                                       "NA", 
                                       summary(por.chla.lm)$coefficients[9,4],
                                       "NA")  

por.stat.df2 <- data.frame(t(por.stat.df[-1]))
colnames(por.stat.df2) <- por.stat.df[, 1]

kable(por.stat.df2, caption = "PAST linear models p-values") %>%
  kable_styling(font_size = 12, full_width = F) %>% 
  row_spec(0, background = "lightgrey") %>% 
  column_spec(1, italic = T, color = "black", background = "lightgrey") %>% 
  column_spec(2:3, color = "#333333", background ="#FF9999") %>%
  column_spec(4:6, color = "#333333", background = "#99CC66")

```


```{r, echo = FALSE}
# Basic linear models for UTEN
ten.carb.lm <- lm <- lm(carb ~ ftemp + fpco2 + reef, data=ten.stat)
ten.pro.lm <- lm <- lm(pro ~ ftemp + fpco2 + reef, data=ten.stat)
ten.den.lm <- lm <- lm(den ~ ftemp + fpco2 + reef , data=ten.stat)
ten.chla.lm <- lm <- lm(chla ~ ftemp + fpco2 + reef, data=ten.stat)
ten.col.lm <- lm <- lm(sum.in ~ ftemp + fpco2 + reef, data=ten.stat)


ten.stat.df <- data.frame("Parameter" = c("Carbohydrate", "Protein", "Symbiont Density", "Chlorophyll a", "Colour Intensity"))

ten.stat.df$`Temperature` <- round(c(summary(ten.carb.lm)$coefficients[2,4],
                                       summary(ten.pro.lm)$coefficients[2,4],
                                       summary(ten.den.lm)$coefficients[2,4], 
                                       summary(ten.chla.lm)$coefficients[2,4],
                                       summary(ten.col.lm)$coefficients[2,4]), 4)

ten.stat.df$`280 pCO2` <- round(c(summary(ten.carb.lm)$coefficients[3,4],
                                       summary(ten.pro.lm)$coefficients[3,4],
                                       summary(ten.den.lm)$coefficients[3,4], 
                                       summary(ten.chla.lm)$coefficients[3,4],
                                       summary(ten.col.lm)$coefficients[3,4]), 4)

ten.stat.df$`700 pCO2` <- round(c(summary(ten.carb.lm)$coefficients[4,4],
                                       summary(ten.pro.lm)$coefficients[4,4],
                                       summary(ten.den.lm)$coefficients[4,4], 
                                       summary(ten.chla.lm)$coefficients[4,4],
                                       summary(ten.col.lm)$coefficients[4,4]), 4)

ten.stat.df$`2800 pCO2` <- round(c(summary(ten.carb.lm)$coefficients[5,4],
                                       summary(ten.pro.lm)$coefficients[5,4],
                                       summary(ten.den.lm)$coefficients[5,4], 
                                       summary(ten.chla.lm)$coefficients[5,4],
                                       summary(ten.col.lm)$coefficients[5,4]), 4)

ten.stat.df$`Reef Environment` <- round(c(summary(ten.carb.lm)$coefficients[6,4],
                                       summary(ten.pro.lm)$coefficients[6,4],
                                       summary(ten.den.lm)$coefficients[6,4], 
                                       summary(ten.chla.lm)$coefficients[6,4],
                                       summary(ten.col.lm)$coefficients[6,4]), 4)    


ten.stat.df2 <- data.frame(t(ten.stat.df[-1]))
colnames(ten.stat.df2) <- ten.stat.df[, 1]

kable(ten.stat.df2, caption = "UTEN linear models p-values") %>%
  kable_styling(font_size = 12, full_width = F) %>% 
  row_spec(0, background = "lightgrey") %>% 
  column_spec(1, italic = T, color = "black", background = "lightgrey") %>% 
  column_spec(2:3, color = "#333333", background ="#FF9999") %>%
  column_spec(4:6, color = "#333333", background = "#99CC66")

```




T90 plot of all parameters by reefzone
```{r, echo=FALSE, fig.height = 10, fig.width = 9, fig.align = "center", results = 'hide'}
# create summary data
T90.reef.sum <- summarySE(data = T90.df, measurevar = "value", groupvars = c("param", "species", "fpco2", "ftemp", "reef"), na.rm = TRUE)

# plot total protein
pro.T90.reef.sum <- subset(T90.reef.sum, param=="pro")

pro.reef.T90.fig <-ggplot(pro.T90.reef.sum, aes(colour=reef, shape = ftemp, group=ftemp))+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.placement = "outside", legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  ylab("total protein")+
  xlab("")+
  geom_point(data=pro.T90, aes(fpco2, value), position = jitter, alpha=0.3, size=1)+
  geom_errorbar(aes(x = fpco2, ymin=value-se, ymax=value+se, width=0.5), position=dodge2, colour="black")+
  geom_point(aes(fpco2, value), position = dodge2, size=2)+
  scale_colour_manual("REef Environment", labels=c("Inshore", "Offshore"), values = c("darkgrey", "orange"))+
  facet_wrap(~species, scales = "free_y", ncol=4)

# plot carbohydrate
carb.T90.reef.sum <- subset(T90.reef.sum, param=="carb")

carb.reef.T90.fig <-ggplot(carb.T90.reef.sum, aes(colour=reef, shape = ftemp, group=ftemp))+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.text.x = element_blank(), legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  ylab("carbohydrate")+
  xlab("")+
  geom_point(data=carb.T90, aes(fpco2, value), position = jitter, alpha=0.3, size=1)+
  geom_errorbar(aes(x = fpco2, ymin=value-se, ymax=value+se, width=0.5), position=dodge2, colour="black")+
  geom_point(aes(fpco2, value), position = dodge2, size=2)+
  scale_colour_manual("REef Environment", labels=c("Inshore", "Offshore"), values = c("darkgrey", "orange"))+
  facet_wrap(~species, scales = "free_y", ncol=4)

# plot symbiont density
den.T90.reef.sum <- subset(T90.reef.sum, param=="den")

den.reef.T90.fig <-ggplot(den.T90.reef.sum, aes(colour=reef, shape = ftemp, group=ftemp))+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.text.x = element_blank(), legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  ylab("symb. density")+
  xlab("")+  
  geom_point(data=den.T90, aes(fpco2, value), position = jitter, alpha=0.3, size=1)+
  geom_errorbar(aes(x = fpco2, ymin=value-se, ymax=value+se, width=0.5), position=dodge2, colour="black")+
  geom_point(aes(fpco2, value), position = dodge2, size=2)+
  scale_colour_manual("REef Environment", labels=c("Inshore", "Offshore"), values = c("darkgrey", "orange"))+
  facet_wrap(~species, scales = "free_y", ncol=4)

# plot chlorophyll
chla.T90.reef.sum <- subset(T90.reef.sum, param=="chla")

chla.reef.T90.fig <-ggplot(chla.T90.reef.sum, aes(colour=reef, shape = ftemp, group=ftemp))+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.text.x = element_blank(), legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  xlab("")+
  ylab("chlorophyll")+
  geom_point(data=chla.T90, aes(fpco2, value), position = jitter, alpha=0.3, size=1)+
  geom_errorbar(aes(x = fpco2, ymin=value-se, ymax=value+se, width=0.5), position=dodge2, colour="black")+
  geom_point(aes(fpco2, value), position = dodge2, size=2)+
  scale_colour_manual("REef Environment", labels=c("Inshore", "Offshore"), values = c("darkgrey", "orange"))+
  facet_wrap(~species, scales = "free_y", ncol=4)

# plot colour intensity
sum_bw5.T90.reef.sum <- subset(T90.reef.sum, param=="sum_bw5")

sum_bw5.reef.T90.fig <-ggplot(sum_bw5.T90.reef.sum, aes(colour=reef, shape = ftemp, group=ftemp))+
  theme(panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.background=element_blank(), axis.line=element_line(color="black"), legend.key=element_blank(), strip.background = element_blank(), strip.text.x = element_blank(), legend.position="none", panel.border = element_rect(colour = "black", fill=NA, size=1))+
  xlab(alab)+
  ylab("colour intensity")+
  geom_point(data=sum_bw5.T90, aes(fpco2, value), position = jitter, alpha=0.3, size=1)+
  geom_errorbar(aes(x = fpco2, ymin=value-se, ymax=value+se, width=0.5), position=dodge2, colour="black")+
  geom_point(aes(fpco2, value), position = dodge2, size=2)+
  scale_colour_manual("REef Environment", labels=c("Inshore", "Offshore"), values = c("darkgrey", "orange"))+
  facet_wrap(~species, scales = "free_y", ncol=4)


# Combine all the plots
phys_reef_plot<- plot_grid(pro.reef.T90.fig, carb.reef.T90.fig, den.reef.T90.fig, chla.reef.T90.fig, sum_bw5.reef.T90.fig, ncol = 1, labels = c('A', 'B', 'C', 'D', 'E'), label_size = 12)
phys_reef_plot

## Create figure name
#fig5 <- paste("T90_reef_noCol_fig", date, sep="_") 
#fig5 <- paste(fig5, ".pdf", sep="") 
#
## save figure as PDF
#pdf(fig5, width = 7, height = 8)
#phys_reef_plot
#dev.set(dev.next())
```


PCA of physiology at T90
```{r, echo=FALSE, fig.height = 4.5, fig.width = 7, fig.align = "center"}
df3 <- df[, -c(18:36)]
names(df3)[17]<-"sum"
pca.df <- na.omit(df3)

pca.out <- prcomp(pca.df[, c(14:19)], scale. = TRUE, centered = TRUE)

species.PCA <- autoplot(pca.out, data = pca.df, 
         colour = "species",
         frame = TRUE, frame.type = 'norm',
         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("Species", labels = c("SSID", "PSTR", "PAST", "UTEN"), values = c("orangered", "seagreen", "goldenrod3", "palevioletred3"))+
scale_fill_manual("Species", labels = c("SSID", "PSTR", "PAST", "UTEN"), values = c("orangered", "seagreen", "goldenrod3", "palevioletred3"))+
  ggtitle("All species")
species.PCA
```

```{r, echo=FALSE, fig.height = 2.7, fig.width = 9, fig.align = "center"}
######## SSID only
s.df <- subset(pca.df, species=="S")
sid.pca.out <- prcomp(s.df[, c(14:19)], scale. = TRUE, center = TRUE)

sid.pco2.PCA <- autoplot(sid.pca.out, data = s.df, 
                         colour = "fpco2",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("280 uatm", "400 uatm", "700 uatm", "2800 uatm"), values = c("#2c7bb6", "#abd9e9", "#fdae61", "#d7191c"))+
  scale_fill_manual("", labels = c("280 uatm", "400 uatm", "700 uatm", "2800 uatm"), values = c("#2c7bb6", "#abd9e9", "#fdae61", "#d7191c"))+
  ggtitle("SSID by pCO2")



sid.temp.PCA <- autoplot(sid.pca.out, data = s.df, 
                         colour = "ftemp",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("28C", "31C"), values = c("blue", "red"))+
  scale_fill_manual("", labels = c("28C", "31C"), values = c("blue", "red"))+
  ggtitle("SSID by temperature")



sid.reef.PCA <- autoplot(sid.pca.out, data = s.df, 
                         colour = "reef",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("Offshore", "Inshore"), values = c("turquoise", "brown"))+
  scale_fill_manual("", labels = c("Offshore", "Inshore"), values = c("turquoise", "brown"))+
  ggtitle("SSID by reef environment")


sid.pca.plot <- plot_grid(sid.pco2.PCA, sid.temp.PCA, sid.reef.PCA, ncol=3)
sid.pca.plot


######## PSTR only
p.df <- subset(pca.df, species=="P")
dip.pca.out <- prcomp(p.df[, c(14:19)], scale. = TRUE, center = TRUE)

dip.pco2.PCA <- autoplot(dip.pca.out, data = p.df, 
                         colour = "fpco2",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("280 uatm", "400 uatm", "700 uatm", "2800 uatm"), values = c("#2c7bb6", "#abd9e9", "#fdae61", "#d7191c"))+
  scale_fill_manual("", labels = c("280 uatm", "400 uatm", "700 uatm", "2800 uatm"), values = c("#2c7bb6", "#abd9e9", "#fdae61", "#d7191c"))+
  ggtitle("PSTR by pCO2")


dip.temp.PCA <- autoplot(dip.pca.out, data = p.df, 
                         colour = "ftemp",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("28C", "31C"), values = c("blue", "red"))+
  scale_fill_manual("", labels = c("28C", "31C"), values = c("blue", "red"))+
  ggtitle("PSTR by temperature")


dip.reef.PCA <- autoplot(dip.pca.out, data = p.df, 
                         colour = "reef",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("Offshore", "Inshore"), values = c("turquoise", "brown"))+
  scale_fill_manual("", labels = c("Offshore", "Inshore"), values = c("turquoise", "brown"))+
  ggtitle("PSTR by reef environment")


dip.pca.plot <- plot_grid(dip.pco2.PCA, dip.temp.PCA, dip.reef.PCA, ncol=3)
dip.pca.plot


######## PAST only
a.df <- subset(pca.df, species=="A")
por.pca.out <- prcomp(a.df[, c(14:19)], scale. = TRUE, center = TRUE)

por.pco2.PCA <- autoplot(por.pca.out, data = a.df, 
                         colour = "fpco2",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("280 uatm", "400 uatm", "700 uatm", "2800 uatm"), values = c("#2c7bb6", "#abd9e9", "#fdae61", "#d7191c"))+
  scale_fill_manual("", labels = c("280 uatm", "400 uatm", "700 uatm", "2800 uatm"), values = c("#2c7bb6", "#abd9e9", "#fdae61", "#d7191c"))+
  ggtitle("PAST by pCO2")


por.temp.PCA <- autoplot(por.pca.out, data = a.df, 
                         colour = "ftemp",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("28C", "31C"), values = c("blue", "red"))+
  scale_fill_manual("", labels = c("28C", "31C"), values = c("blue", "red"))+
  ggtitle("PAST by temperature")


por.reef.PCA <- autoplot(por.pca.out, data = a.df, 
                         colour = "reef",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("Offshore", "Inshore"), values = c("turquoise", "brown"))+
  scale_fill_manual("", labels = c("Offshore", "Inshore"), values = c("turquoise", "brown"))+
  ggtitle("PAST by reef environment")


por.pca.plot <- plot_grid(por.pco2.PCA, por.temp.PCA, por.reef.PCA, ncol=3)
por.pca.plot


######## UTEN only
t.df <- subset(pca.df, species=="T")
ten.pca.out <- prcomp(t.df[, c(14:19)], scale. = TRUE, center = TRUE)

ten.pco2.PCA <- autoplot(ten.pca.out, data = t.df, 
                         colour = "fpco2",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("280 uatm", "400 uatm", "700 uatm", "2800 uatm"), values = c("#2c7bb6", "#abd9e9", "#fdae61", "#d7191c"))+
  scale_fill_manual("", labels = c("280 uatm", "400 uatm", "700 uatm", "2800 uatm"), values = c("#2c7bb6", "#abd9e9", "#fdae61", "#d7191c"))+
  ggtitle("UTEN by pCO2")


ten.temp.PCA <- autoplot(ten.pca.out, data = t.df, 
                         colour = "ftemp",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("28C", "31C"), values = c("blue", "red"))+
  scale_fill_manual("", labels = c("28C", "31C"), values = c("blue", "red"))+
  ggtitle("UTEN by temperature")


ten.reef.PCA <- autoplot(ten.pca.out, data = t.df, 
                         colour = "reef",
                         frame = TRUE, frame.type = 'norm',
                         loadings = TRUE, loadings.colour = 'black', loadings.label = TRUE, loadings.label.size = 4)+
  theme_classic()+
  scale_colour_manual("", labels = c("Offshore", "Inshore"), values = c("turquoise", "brown"))+
  scale_fill_manual("", labels = c("Offshore", "Inshore"), values = c("turquoise", "brown"))+
  ggtitle("UTEN by reef environment")


ten.pca.plot <- plot_grid(ten.pco2.PCA, ten.temp.PCA, ten.reef.PCA, ncol=3)
ten.pca.plot
```



Comparison between physiological parameters per fragment
<font color='darkmagenta'>Linear Regression between carbohydrate and protein</font>  
<div style= "float:left;position:">
```{r, echo=FALSE, fig.height = 4.5, fig.width = 4.5, fig.align = "center"}
df$sum_bw5 <- df$sum_bw5 * -1
df.90b <- df[,c(1:17, 37:38)]

df.90b.S <- subset(df.90b, species=="S")
df.90b.P <- subset(df.90b, species=="P")
df.90b.A <- subset(df.90b, species=="A")
df.90b.T <- subset(df.90b, species=="T")

carb.pro.lm <- summary(lm(pro ~ carb, data=df.90b))
carb.pro.R2 <- carb.pro.lm$adj.r.squared

Scarb.pro.lm <- summary(lm(pro ~ carb, data=df.90b.S))
Scarb.pro.R2 <- Scarb.pro.lm$adj.r.squared

Pcarb.pro.lm <- summary(lm(pro ~ carb, data=df.90b.P))
Pcarb.pro.R2 <- Pcarb.pro.lm$adj.r.squared

Acarb.pro.lm <- summary(lm(pro ~ carb, data=df.90b.A))
Acarb.pro.R2 <- Acarb.pro.lm$adj.r.squared

Tcarb.pro.lm <- summary(lm(pro ~ carb, data=df.90b.T))
Tcarb.pro.R2 <- Tcarb.pro.lm$adj.r.squared

ggplot(df.90b, aes(x = pro, y = carb, colour = treat, group = species))+
  geom_point()+
  theme(plot.title = element_text(hjust = 0.5, size = 10), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.position = "none")+
  geom_smooth(method="lm", colour="darkgrey", se=FALSE)+
  facet_wrap(~species, scales = "free", ncol=2, labeller = as_labeller(c("S" = "SSID", "P" = "PSTR", "A" = "PAST", "T" = "UTEN")))+
  xlab(calab)+
  ylab(plab)+
  ggtitle(bquote(bold(atop("Rs"^2 == .(Scarb.pro.R2)~ ";  Rp"^2 == .(Pcarb.pro.R2),
                           ~" Ra"^2 == .(Acarb.pro.R2)~ ";  Rt"^2 == .(Tcarb.pro.R2)))))
```
</div>
***
```{r, echo=FALSE}
carb.pro.lm
```
***
<font color='darkmagenta'>Linear Regression between chlorophyll and symbiont density</font>  
<div style= "float:left;position:">
```{r, echo=FALSE, fig.height = 4.5, fig.width = 4.5, fig.align = "center"}
den.chla.lm <- summary(lm(chla ~ den, data=df.90b))
den.chla.R2 <- den.chla.lm$adj.r.squared

Sden.chla.lm <- summary(lm(chla ~ den, data=df.90b.S))
Sden.chla.R2 <- Sden.chla.lm$adj.r.squared

Pden.chla.lm <- summary(lm(chla ~ den, data=df.90b.P))
Pden.chla.R2 <- Pden.chla.lm$adj.r.squared

Aden.chla.lm <- summary(lm(chla ~ den, data=df.90b.A))
Aden.chla.R2 <- Aden.chla.lm$adj.r.squared

Tden.chla.lm <- summary(lm(chla ~ den, data=df.90b.T))
Tden.chla.R2 <- Tden.chla.lm$adj.r.squared

ggplot(df.90b, aes(x = chla, y = den, colour = treat, group = species))+
  geom_point()+
  theme(plot.title = element_text(hjust = 0.5, size = 10), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.position = "none")+
  geom_smooth(method="lm", colour="darkgrey", se=FALSE)+
  facet_wrap(~species, ncol=2, scales = "free", labeller = as_labeller(c("S" = "SSID", "P" = "PSTR", "A" = "PAST", "T" = "UTEN")))+
  xlab(clab)+
  ylab(dlab)+
  ggtitle(bquote(bold(atop("Rs"^2 == .(Sden.chla.R2)~ ";  Rp"^2 == .(Pden.chla.R2),
                           ~"Ra"^2 == .(Aden.chla.R2)~ ";  Rt"^2 == .(Tden.chla.R2)))))
```
</div>
***
```{r, echo=FALSE}
den.chla.lm
```
***

<font color='darkmagenta'>Linear Regression between colour intensity and symbiont density</font>  
<div style= "float:left;position:">
```{r, echo=FALSE, fig.height = 4.5, fig.width = 4.5, fig.align = "center"}
den.sum_bw5.lm <- summary(lm(sum_bw5 ~ den, data=df.90b))
den.sum_bw5.R2 <- den.sum_bw5.lm$adj.r.squared

Sden.sum_bw5.lm <- summary(lm(sum_bw5 ~ den, data=df.90b.S))
Sden.sum_bw5.R2 <- Sden.sum_bw5.lm$adj.r.squared

Pden.sum_bw5.lm <- summary(lm(sum_bw5 ~ den, data=df.90b.P))
Pden.sum_bw5.R2 <- Pden.sum_bw5.lm$adj.r.squared

Aden.sum_bw5.lm <- summary(lm(sum_bw5 ~ den, data=df.90b.A))
Aden.sum_bw5.R2 <- Aden.sum_bw5.lm$adj.r.squared

Tden.sum_bw5.lm <- summary(lm(sum_bw5 ~ den, data=df.90b.T))
Tden.sum_bw5.R2 <- Tden.sum_bw5.lm$adj.r.squared

ggplot(df.90b, aes(x = sum_bw5, y = den, colour = treat, group = species))+
  geom_point()+
  theme(plot.title = element_text(hjust = 0.5, size = 10), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.position = "none")+
  geom_smooth(method="lm", colour="darkgrey", se=FALSE)+
  facet_wrap(~species, ncol=2, scales = "free", labeller = as_labeller(c("S" = "SSID", "P" = "PSTR", "A" = "PAST", "T" = "UTEN")))+
  xlab("colour intensity")+
  ylab(dlab)+
  ggtitle(bquote(bold(atop("Rs"^2 == .(Sden.sum_bw5.R2)~ ";  Rp"^2 == .(Pden.sum_bw5.R2),
                           ~"Ra"^2 == .(Aden.sum_bw5.R2)~ ";  Rt"^2 == .(Tden.sum_bw5.R2)))))
```
</div>
***
```{r, echo=FALSE}
den.sum_bw5.lm
```
***

<font color='darkmagenta'>Linear Regression between colour intensity and chlorophyll</font>  
<div style= "float:left;position:">
```{r, echo=FALSE, fig.height = 4.5, fig.width = 4.5, fig.align = "center"}
chla.sum_bw5.lm <- summary(lm(sum_bw5 ~ chla, data=df.90b))
chla.sum_bw5.R2 <- chla.sum_bw5.lm$adj.r.squared

Schla.sum_bw5.lm <- summary(lm(sum_bw5 ~ chla, data=df.90b.S))
Schla.sum_bw5.R2 <- Schla.sum_bw5.lm$adj.r.squared

Pchla.sum_bw5.lm <- summary(lm(sum_bw5 ~ chla, data=df.90b.P))
Pchla.sum_bw5.R2 <- Pchla.sum_bw5.lm$adj.r.squared

Achla.sum_bw5.lm <- summary(lm(sum_bw5 ~ chla, data=df.90b.A))
Achla.sum_bw5.R2 <- Achla.sum_bw5.lm$adj.r.squared

Tchla.sum_bw5.lm <- summary(lm(sum_bw5 ~ chla, data=df.90b.T))
Tchla.sum_bw5.R2 <- Tchla.sum_bw5.lm$adj.r.squared

ggplot(df.90b, aes(x = sum_bw5, y = chla, colour = treat, group = species))+
  geom_point()+
  theme(plot.title = element_text(hjust = 0.5, size = 10), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.position = "none")+
  geom_smooth(method="lm", colour="darkgrey", se=FALSE)+
  facet_wrap(~species, ncol=2, scales = "free", labeller = as_labeller(c("S" = "SSID", "P" = "PSTR", "A" = "PAST", "T" = "UTEN")))+
  xlab("colour intensity")+
  ylab(clab)+
  ggtitle(bquote(bold(atop("Rs"^2 == .(Schla.sum_bw5.R2)~ ";  Rp"^2 == .(Pchla.sum_bw5.R2),
                           ~"Ra"^2 == .(Achla.sum_bw5.R2)~ ";  Rt"^2 == .(Tchla.sum_bw5.R2)))))
```
</div>
***  
```{r, echo=FALSE}
chla.sum_bw5.lm
```
***
  
<font color='darkmagenta'>Linear Regression between protein and chlorophyll</font>  
<div style= "float:left;position:">
```{r, echo=FALSE, fig.height = 4.5, fig.width = 4.5, fig.align = "center"}
df.90b.S <- subset(df.90b, species=="S")
df.90b.P <- subset(df.90b, species=="P")
df.90b.A <- subset(df.90b, species=="A")
df.90b.T <- subset(df.90b, species=="T")

chla.pro.lm <- summary(lm(pro ~ chla, data=df.90b))
chla.pro.R2 <- chla.pro.lm$adj.r.squared

Schla.pro.lm <- summary(lm(pro ~ chla, data=df.90b.S))
Schla.pro.R2 <- Schla.pro.lm$adj.r.squared

Pchla.pro.lm <- summary(lm(pro ~ chla, data=df.90b.P))
Pchla.pro.R2 <- Pchla.pro.lm$adj.r.squared

Achla.pro.lm <- summary(lm(pro ~ chla, data=df.90b.A))
Achla.pro.R2 <- Achla.pro.lm$adj.r.squared

Tchla.pro.lm <- summary(lm(pro ~ chla, data=df.90b.T))
Tchla.pro.R2 <- Tchla.pro.lm$adj.r.squared

ggplot(df.90b, aes(x = pro, y = chla, colour = treat, group = species))+
  geom_point()+
  theme(plot.title = element_text(hjust = 0.5, size = 10), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.position = "none")+
  geom_smooth(method="lm", colour="darkgrey", se=FALSE)+
  facet_wrap(~species, ncol=2, scales = "free", labeller = as_labeller(c("S" = "SSID", "P" = "PSTR", "A" = "PAST", "T" = "UTEN")))+
  xlab(plab)+
  ylab(clab)+
  ggtitle(bquote(bold(atop("Rs"^2 == .(Schla.pro.R2)~ ";  Rp"^2 == .(Pchla.pro.R2),
                           ~"Ra"^2 == .(Achla.pro.R2)~ ";  Rt"^2 == .(Tchla.pro.R2)))))
```
</div>
***  
```{r, echo=FALSE}
    chla.pro.lm
```
***
  
<font color='darkmagenta'>Linear Regression between carbohydrate and chlorophyll</font>  
<div style= "float:left;position:">
```{r, echo=FALSE, fig.height = 4.5, fig.width = 4.5, fig.align = "center"}
df.90b.S <- subset(df.90b, species=="S")
df.90b.P <- subset(df.90b, species=="P")
df.90b.A <- subset(df.90b, species=="A")
df.90b.T <- subset(df.90b, species=="T")

chla.carb.lm <- summary(lm(carb ~ chla, data=df.90b))
chla.carb.R2 <- chla.carb.lm$adj.r.squared

Schla.carb.lm <- summary(lm(carb ~ chla, data=df.90b.S))
Schla.carb.R2 <- Schla.carb.lm$adj.r.squared

Pchla.carb.lm <- summary(lm(carb ~ chla, data=df.90b.P))
Pchla.carb.R2 <- Pchla.carb.lm$adj.r.squared

Achla.carb.lm <- summary(lm(carb ~ chla, data=df.90b.A))
Achla.carb.R2 <- Achla.carb.lm$adj.r.squared

Tchla.carb.lm <- summary(lm(carb ~ chla, data=df.90b.T))
Tchla.carb.R2 <- Tchla.carb.lm$adj.r.squared

ggplot(df.90b, aes(x = carb, y = chla, colour = treat, group = species))+
  geom_point()+
  theme(plot.title = element_text(hjust = 0.5, size = 10), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.position = "none")+
  geom_smooth(method="lm", colour="darkgrey", se=FALSE)+
  facet_wrap(~species, ncol=2, scales = "free", labeller = as_labeller(c("S" = "SSID", "P" = "PSTR", "A" = "PAST", "T" = "UTEN")))+
  xlab(calab)+
  ylab(clab)+
  ggtitle(bquote(bold(atop("Rs"^2 == .(Schla.carb.R2)~ ";  Rp"^2 == .(Pchla.carb.R2),
                           ~"Ra"^2 == .(Achla.carb.R2)~ ";  Rt"^2 == .(Tchla.carb.R2)))))
```
</div>
***  
```{r, echo=FALSE}
chla.carb.lm
```
***

<font color='darkmagenta'>Linear Regression between protein and calcification rate</font>  
<div style= "float:left;position:">
```{r, echo=FALSE, fig.height = 4.5, fig.width = 4.5, fig.align = "center"}
rate.pro.lm <- summary(lm(pro ~ rate, data=df.90b))
rate.pro.R2 <- rate.pro.lm$adj.r.squared

Srate.pro.lm <- summary(lm(pro ~ rate, data=df.90b.S))
Srate.pro.R2 <- Srate.pro.lm$adj.r.squared

Prate.pro.lm <- summary(lm(pro ~ rate, data=df.90b.P))
Prate.pro.R2 <- Prate.pro.lm$adj.r.squared

Arate.pro.lm <- summary(lm(pro ~ rate, data=df.90b.A))
Arate.pro.R2 <- Arate.pro.lm$adj.r.squared

Trate.pro.lm <- summary(lm(pro ~ rate, data=df.90b.T))
Trate.pro.R2 <- Trate.pro.lm$adj.r.squared

ggplot(df.90b, aes(x = pro, y = rate, colour = treat, group = species))+
  geom_point()+
  theme(plot.title = element_text(hjust = 0.5, size = 10), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.position = "none")+
  geom_smooth(method="lm", colour="darkgrey", se=FALSE)+
  facet_wrap(~species, ncol=2, scales = "free", labeller = as_labeller(c("S" = "SSID", "P" = "PSTR", "A" = "PAST", "T" = "UTEN")))+
  xlab(plab)+
  ylab(rlab)+
  ggtitle(bquote(bold(atop("Rs"^2 == .(Srate.pro.R2)~ ";  Rp"^2 == .(Prate.pro.R2),
                           ~"Ra"^2 == .(Arate.pro.R2)~ ";  Rt"^2 == .(Trate.pro.R2)))))
```
</div>
***
```{r, echo=FALSE}
rate.pro.lm
```
***
 
<font color='darkmagenta'>Linear Regression between carbohydrate and calcification rate</font>  
<div style= "float:left;position:">
```{r, echo=FALSE, fig.height = 4.5, fig.width = 4.5, fig.align = "center"}
rate.carb.lm <- summary(lm(carb ~ rate, data=df.90b))
rate.carb.R2 <- rate.carb.lm$adj.r.squared

Srate.carb.lm <- summary(lm(carb ~ rate, data=df.90b.S))
Srate.carb.R2 <- Srate.carb.lm$adj.r.squared

Prate.carb.lm <- summary(lm(carb ~ rate, data=df.90b.P))
Prate.carb.R2 <- Prate.carb.lm$adj.r.squared

Arate.carb.lm <- summary(lm(carb ~ rate, data=df.90b.A))
Arate.carb.R2 <- Arate.carb.lm$adj.r.squared

Trate.carb.lm <- summary(lm(carb ~ rate, data=df.90b.T))
Trate.carb.R2 <- Trate.carb.lm$adj.r.squared

ggplot(df.90b, aes(x = carb, y = rate, colour = treat, group = species))+
 geom_point()+
 theme(plot.title = element_text(hjust = 0.5, size = 10), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.position = "none")+
  geom_smooth(method="lm", colour="darkgrey", se=FALSE)+
  facet_wrap(~species, ncol=2, scales = "free", labeller = as_labeller(c("S" = "SSID", "P" = "PSTR", "A" = "PAST", "T" = "UTEN")))+
  xlab(calab)+
  ylab(rlab)+
  ggtitle(bquote(bold(atop("Rs"^2 == .(Srate.carb.R2)~ ";  Rp"^2 == .(Prate.carb.R2),
                           ~"Ra"^2 == .(Arate.carb.R2)~ ";  Rt"^2 == .(Trate.carb.R2)))))
```
</div>
***
```{r, echo=FALSE}
rate.carb.lm
```    

***
  
<font color='darkmagenta'>Linear Regression between chlorophyll and calcification rate</font>  
<div style= "float:left;position:">
```{r, echo=FALSE, fig.height = 4.5, fig.width = 4.5, fig.align = "center"}
rate.chla.lm <- summary(lm(chla ~ rate, data=df.90b))
rate.chla.R2 <- rate.chla.lm$adj.r.squared

Srate.chla.lm <- summary(lm(chla ~ rate, data=df.90b.S))
Srate.chla.R2 <- Srate.chla.lm$adj.r.squared

Prate.chla.lm <- summary(lm(chla ~ rate, data=df.90b.P))
Prate.chla.R2 <- Prate.chla.lm$adj.r.squared

Arate.chla.lm <- summary(lm(chla ~ rate, data=df.90b.A))
Arate.chla.R2 <- Arate.chla.lm$adj.r.squared

Trate.chla.lm <- summary(lm(chla ~ rate, data=df.90b.T))
Trate.chla.R2 <- Trate.chla.lm$adj.r.squared

ggplot(df.90b, aes(x = chla, y = rate, colour = treat, group = species))+
  geom_point()+
  theme(plot.title = element_text(hjust = 0.5, size = 10), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.position = "none")+
  geom_smooth(method="lm", colour="darkgrey", se=FALSE)+
  facet_wrap(~species, ncol=2, scales = "free", labeller = as_labeller(c("S" = "SSID", "P" = "PSTR", "A" = "PAST", "T" = "UTEN")))+
  xlab(clab)+
  ylab(rlab)+
  ggtitle(bquote(bold(atop("Rs"^2 == .(Srate.chla.R2)~ ";  Rp"^2 == .(Prate.chla.R2),
                           ~"Ra"^2 == .(Arate.chla.R2)~ ";  Rt"^2 == .(Trate.chla.R2)))))
```
</div>
***
```{r, echo=FALSE}
rate.chla.lm
```  

***

<font color='darkmagenta'>Linear Regression between symbiont density and calcification rate</font>  
<div style= "float:left;position:">
```{r, echo=FALSE, fig.height = 4.5, fig.width = 4.5, fig.align = "center"}
rate.den.lm <- summary(lm(den ~ rate, data=df.90b))
rate.den.R2 <- rate.den.lm$adj.r.squared

Srate.den.lm <- summary(lm(den ~ rate, data=df.90b.S))
Srate.den.R2 <- Srate.den.lm$adj.r.squared

Prate.den.lm <- summary(lm(den ~ rate, data=df.90b.P))
Prate.den.R2 <- Prate.den.lm$adj.r.squared

Arate.den.lm <- summary(lm(den ~ rate, data=df.90b.A))
Arate.den.R2 <- Arate.den.lm$adj.r.squared

Trate.den.lm <- summary(lm(den ~ rate, data=df.90b.T))
Trate.den.R2 <- Trate.den.lm$adj.r.squared

ggplot(df.90b, aes(x = den, y = rate, colour = treat, group = species))+
  geom_point()+
  theme(plot.title = element_text(hjust = 0.5, size = 10), panel.border = element_rect(colour = "black", fill=NA, size=1), legend.position = "none")+
  geom_smooth(method="lm", colour="darkgrey", se=FALSE)+
  facet_wrap(~species, ncol=2, scales = "free", labeller = as_labeller(c("S" = "SSID", "P" = "PSTR", "A" = "PAST", "T" = "UTEN")))+
  xlab(dlab)+
  ylab(rlab)+
  ggtitle(bquote(bold(atop("Rs"^2 == .(Srate.den.R2)~ ";  Rp"^2 == .(Prate.den.R2),
                           ~"Ra"^2 == .(Arate.den.R2)~ ";  Rt"^2 == .(Trate.den.R2)))))
```
</div>
***
```{r, echo=FALSE}
rate.den.lm
```    